"use strict";class t{browserShadowBlurConstant=1;DPI=96;devicePixelRatio=1;perfLimitSizeTotal=2097152;maxCacheSideLimit=4096;minCacheSideLimit=256;disableStyleCopyPaste=!1;enableGLFiltering=!0;textureSize=4096;forceGLPutImageData=!1;cachesBoundsOfCurve=!0;fontPaths={};NUM_FRACTION_DIGITS=4}const e=new class extends t{constructor(t){super(),this.configure(t)}configure(t={}){Object.assign(this,t)}addFonts(t={}){this.fontPaths={...this.fontPaths,...t}}removeFonts(t=[]){t.forEach((t=>{delete this.fontPaths[t]}))}clearFonts(){this.fontPaths={}}restoreDefaults(e){const s=new t,i=e?.reduce(((t,e)=>(t[e]=s[e],t)),{})||s;this.configure(i)}};const s=new class{charWidthsCache={};getFontCache({fontFamily:t,fontStyle:e,fontWeight:s}){t=t.toLowerCase(),this.charWidthsCache[t]||(this.charWidthsCache[t]={});const i=this.charWidthsCache[t],r=`${e.toLowerCase()}_${(s+"").toLowerCase()}`;return i[r]||(i[r]={}),i[r]}clearFontCache(t){(t=(t||"").toLowerCase())?this.charWidthsCache[t]&&delete this.charWidthsCache[t]:this.charWidthsCache={}}limitDimsByArea(t){const{perfLimitSizeTotal:s}=e,i=Math.sqrt(s*t);return[Math.floor(i),Math.floor(s/i)]}arcToSegmentsCache={};boundsOfCurveCache={}};function i(){}const r=Math.PI/2,n=2*Math.PI,o=Math.PI/180,a=Object.freeze([1,0,0,1,0,0]),h=.4477152502,c="6";var l=l||{version:c,config:e,cache:s,iMatrix:a};if("undefined"!=typeof exports?exports.fabric=l:"function"==typeof define&&define.amd&&define([],(function(){return l})),"undefined"!=typeof document&&"undefined"!=typeof window)document instanceof("undefined"!=typeof HTMLDocument?HTMLDocument:Document)?l.document=document:l.document=document.implementation.createHTMLDocument(""),l.window=window,window.fabric=l;else{var u=new(require("jsdom").JSDOM)(decodeURIComponent("%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E"),{features:{FetchExternalResources:["img"]},resources:"usable"}).window;l.document=u.document,l.jsdomImplForWrapper=require("jsdom/lib/jsdom/living/generated/utils").implForWrapper,l.nodeCanvas=require("jsdom/lib/jsdom/utils").Canvas,l.window=u,global.DOMParser=l.window.DOMParser}l.isTouchSupported="ontouchstart"in l.window||"ontouchstart"in l.document||l.window&&l.window.navigator&&l.window.navigator.maxTouchPoints>0,l.isLikelyNode="undefined"!=typeof Buffer&&"undefined"==typeof window,e.configure({devicePixelRatio:l.window.devicePixelRatio||l.window.webkitDevicePixelRatio||l.window.mozDevicePixelRatio||1});const d=(t,e)=>isNaN(t)&&"number"==typeof e?e:t,g=(t,e)=>{const s=t.indexOf(e);return-1!==s&&t.splice(s,1),t};function f(t){class e extends t{_objects=[];_onObjectAdded(t){}_onObjectRemoved(t){}_onStackOrderChanged(t){}add(...t){const e=this._objects.push(...t);return t.forEach((t=>this._onObjectAdded(t))),e}insertAt(t,...e){return this._objects.splice(t,0,...e),e.forEach((t=>this._onObjectAdded(t))),this._objects.length}remove(...t){const e=this._objects,s=[];return t.forEach((t=>{const i=e.indexOf(t);-1!==i&&(e.splice(i,1),s.push(t),this._onObjectRemoved(t))})),s}forEachObject(t){this.getObjects().forEach(((e,s,i)=>t(e,s,i)))}getObjects(...t){return 0===t.length?[...this._objects]:this._objects.filter((e=>t.includes(e.type)))}item(t){return this._objects[t]}isEmpty(){return 0===this._objects.length}size(){return this._objects.length}contains(t,s){return!!this._objects.includes(t)||!!s&&this._objects.some((s=>s instanceof e&&s.contains(t,!0)))}complexity(){return this._objects.reduce(((t,e)=>t+=e.complexity?e.complexity():0),0)}sendObjectToBack(t){return!(!t||t===this._objects[0])&&(g(this._objects,t),this._objects.unshift(t),this._onStackOrderChanged(t),!0)}bringObjectToFront(t){return!(!t||t===this._objects[this._objects.length-1])&&(g(this._objects,t),this._objects.push(t),this._onStackOrderChanged(t),!0)}sendObjectBackwards(t,e){if(!t)return!1;const s=this._objects.indexOf(t);if(0!==s){const i=this.findNewLowerIndex(t,s,e);return g(this._objects,t),this._objects.splice(i,0,t),this._onStackOrderChanged(t),!0}return!1}bringObjectForward(t,e){if(!t)return!1;const s=this._objects.indexOf(t);if(s!==this._objects.length-1){const i=this.findNewUpperIndex(t,s,e);return g(this._objects,t),this._objects.splice(i,0,t),this._onStackOrderChanged(t),!0}return!1}moveObjectTo(t,e){return t!==this._objects[e]&&(g(this._objects,t),this._objects.splice(e,0,t),this._onStackOrderChanged(t),!0)}findNewLowerIndex(t,e,s){let i;if(s){i=e;for(let s=e-1;s>=0;--s)if(t.isOverlapping(this._objects[s])){i=s;break}}else i=e-1;return i}findNewUpperIndex(t,e,s){let i;if(s){i=e;for(let s=e+1;s<this._objects.length;++s)if(t.isOverlapping(this._objects[s])){i=s;break}}else i=e+1;return i}}return e}l.createCollectionMixin=f;class p{__eventListeners={};on(t,e){if(this.__eventListeners||(this.__eventListeners={}),"object"==typeof t){for(const e in t)this.on(e,t[e]);return()=>this.off(t)}if(e){const s=t;return this.__eventListeners[s]||(this.__eventListeners[s]=[]),this.__eventListeners[s].push(e),()=>this.off(s,e)}return()=>!1}once(t,e){if("object"==typeof t){const e=[];for(const s in t)e.push(this.once(s,t[s]));return()=>e.forEach((t=>t()))}if(e){const s=this.on(t,((...t)=>{e(...t),s()}));return s}return()=>!1}_removeEventListener(t,e){if(this.__eventListeners[t])if(e){const s=this.__eventListeners[t],i=s.indexOf(e);i>-1&&s.splice(i,1)}else this.__eventListeners[t]=[]}off(t,e){if(this.__eventListeners)if(void 0===t)for(const t in this.__eventListeners)this._removeEventListener(t);else if("object"==typeof t)for(const e in t)this._removeEventListener(e,t[e]);else this._removeEventListener(t,e)}fire(t,e){if(!this.__eventListeners)return;const s=this.__eventListeners[t]?.concat();if(s)for(let t=0;t<s.length;t++)s[t].call(this,e||{})}}l.Observable=p;class m extends p{_setOptions(t){for(const e in t)this.set(e,t[e])}_setObject(t){for(const e in t)this._set(e,t[e])}set(t,e){return"object"==typeof t?this._setObject(t):this._set(t,e),this}_set(t,e){this[t]=e}toggle(t){const e=this.get(t);return"boolean"==typeof e&&this.set(t,!e),this}get(t){return this[t]}}const v=t=>{if(0===t)return 1;switch(Math.abs(t)/r){case 1:case 3:return 0;case 2:return-1}return Math.cos(t)},_=t=>{if(0===t)return 0;const e=t/r,s=Math.sign(t);switch(e){case 1:return s;case 2:return 0;case 3:return-s}return Math.sin(t)};class y{x;y;constructor(t=0,e=0){"object"==typeof t?(this.x=t.x,this.y=t.y):(this.x=t,this.y=e)}add(t){return new y(this.x+t.x,this.y+t.y)}addEquals(t){return this.x+=t.x,this.y+=t.y,this}scalarAdd(t){return new y(this.x+t,this.y+t)}scalarAddEquals(t){return this.x+=t,this.y+=t,this}subtract(t){return new y(this.x-t.x,this.y-t.y)}subtractEquals(t){return this.x-=t.x,this.y-=t.y,this}scalarSubtract(t){return new y(this.x-t,this.y-t)}scalarSubtractEquals(t){return this.x-=t,this.y-=t,this}multiply(t){return new y(this.x*t.x,this.y*t.y)}scalarMultiply(t){return new y(this.x*t,this.y*t)}scalarMultiplyEquals(t){return this.x*=t,this.y*=t,this}divide(t){return new y(this.x/t.x,this.y/t.y)}scalarDivide(t){return new y(this.x/t,this.y/t)}scalarDivideEquals(t){return this.x/=t,this.y/=t,this}eq(t){return this.x===t.x&&this.y===t.y}lt(t){return this.x<t.x&&this.y<t.y}lte(t){return this.x<=t.x&&this.y<=t.y}gt(t){return this.x>t.x&&this.y>t.y}gte(t){return this.x>=t.x&&this.y>=t.y}lerp(t,e=.5){return e=Math.max(Math.min(1,e),0),new y(this.x+(t.x-this.x)*e,this.y+(t.y-this.y)*e)}distanceFrom(t){const e=this.x-t.x,s=this.y-t.y;return Math.sqrt(e*e+s*s)}midPointFrom(t){return this.lerp(t)}min(t){return new y(Math.min(this.x,t.x),Math.min(this.y,t.y))}max(t){return new y(Math.max(this.x,t.x),Math.max(this.y,t.y))}toString(){return`${this.x},${this.y}`}setXY(t,e){return this.x=t,this.y=e,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setFromPoint(t){return this.x=t.x,this.y=t.y,this}swap(t){const e=this.x,s=this.y;this.x=t.x,this.y=t.y,t.x=e,t.y=s}clone(){return new y(this.x,this.y)}rotate(t,e=b){const s=_(t),i=v(t),r=this.subtract(e);return new y(r.x*i-r.y*s,r.x*s+r.y*i).add(e)}transform(t,e=!1){return new y(t[0]*this.x+t[2]*this.y+(e?0:t[4]),t[1]*this.x+t[3]*this.y+(e?0:t[5]))}}const b=new y(0,0);l.Point=y;const C=l.window.requestAnimationFrame||function(t){return l.window.setTimeout(t,1e3/60)},w=l.window.cancelAnimationFrame||l.window.clearTimeout;function x(t){return C.call(l.window,t)}const O=new class extends Array{remove(t){const e=this.indexOf(t);e>-1&&this.splice(e,1)}cancelAll(){const t=this.splice(0);return t.forEach((t=>t.abort())),t}cancelByCanvas(t){if(!t)return[];const e=this.filter((e=>"object"==typeof e.target&&e.target?.canvas===t));return e.forEach((t=>t.abort())),e}cancelByTarget(t){if(!t)return[];const e=this.filter((e=>e.target===t));return e.forEach((t=>t.abort())),e}};l.runningAnimations=O;const S=(t,e,s,i)=>-s*Math.cos(t/i*r)+s+e,k=()=>!1;class T{startValue;byValue;endValue;duration;delay;easing;_onStart;_onChange;_onComplete;_abort;target;_state="pending";durationRatio=0;valueRatio=0;value;startTime;constructor({startValue:t,byValue:e,duration:s=500,delay:r=0,easing:n=S,onStart:o=i,onChange:a=i,onComplete:h=i,abort:c=k,target:l}){this.tick=this.tick.bind(this),this.duration=s,this.delay=r,this.easing=n,this._onStart=o,this._onChange=a,this._onComplete=h,this._abort=c,this.target=l,this.startValue=t,this.byValue=e,this.value=this.startValue,this.endValue=this.calculate(this.duration).value}get state(){return this._state}start(){const t=t=>{"pending"===this._state&&(this.startTime=t||+new Date,this._state="running",this._onStart(),this.tick(this.startTime))};this.register(),this.delay>0?setTimeout((()=>x(t)),this.delay):x(t)}tick(t){const e=(t||+new Date)-this.startTime,s=Math.min(e,this.duration);this.durationRatio=s/this.duration;const{value:i,changeRatio:r}=this.calculate(s);if(this.value=Array.isArray(i)?i.slice():i,this.valueRatio=r,"aborted"!==this._state)if(this._abort(i,this.valueRatio,this.durationRatio))this._state="aborted",this.unregister();else if(e>=this.duration){const t=this.endValue;this.durationRatio=this.valueRatio=1,this._onChange(Array.isArray(t)?t.slice():t,this.valueRatio,this.durationRatio),this._state="completed",this._onComplete(t,this.valueRatio,this.durationRatio),this.unregister()}else this._onChange(i,this.valueRatio,this.durationRatio),x(this.tick)}register(){O.push(this)}unregister(){O.remove(this)}abort(){this._state="aborted",this.unregister()}}class j extends T{constructor({startValue:t=0,endValue:e=100,byValue:s=e-t,...i}){super({...i,startValue:t,byValue:s})}calculate(t){const e=this.easing(t,this.startValue,this.byValue,this.duration);return{value:e,changeRatio:Math.abs((e-this.startValue)/this.byValue)}}}class E extends T{constructor({startValue:t=[0],endValue:e=[100],byValue:s=e.map(((e,s)=>e-t[s])),...i}){super({...i,startValue:t,byValue:s})}calculate(t){const e=this.startValue.map(((e,s)=>this.easing(t,e,this.byValue[s],this.duration,s)));return{value:e,changeRatio:Math.abs((e[0]-this.startValue[0])/this.byValue[0])}}}const D={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"},A=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?%?)\s*,\s*(\d{1,3}(?:\.\d+)?%?)\s*,\s*(\d{1,3}(?:\.\d+)?%?)\s*(?:\s*,\s*((?:\d*\.?\d+)?)\s*)?\)$/i,M=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}%)\s*,\s*(\d{1,3}%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/i,F=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i;function P(t,e,s){return s<0&&(s+=1),s>1&&(s-=1),s<1/6?t+6*(e-t)*s:s<.5?e:s<2/3?t+(e-t)*(2/3-s)*6:t}function R(t){const e=t.toString(16).toUpperCase();return 1===e.length?`0${e}`:e}class X{_source;constructor(t){if(t)if(t instanceof X)this.setSource([...t._source]);else if(Array.isArray(t)){const[e,s,i,r=1]=t;this.setSource([e,s,i,r])}else this.setSource(this._tryParsingColor(t));else this.setSource([0,0,0,1])}_tryParsingColor(t){return t in D&&(t=D[t]),"transparent"===t?[255,255,255,0]:X.sourceFromHex(t)||X.sourceFromRgb(t)||X.sourceFromHsl(t)||[0,0,0,1]}_rgbToHsl(t,e,s){t/=255,e/=255,s/=255;const i=Math.max(t,e,s),r=Math.min(t,e,s);let n,o;const a=(i+r)/2;if(i===r)n=o=0;else{const h=i-r;switch(o=a>.5?h/(2-i-r):h/(i+r),i){case t:n=(e-s)/h+(e<s?6:0);break;case e:n=(s-t)/h+2;break;case s:n=(t-e)/h+4}n/=6}return[Math.round(360*n),Math.round(100*o),Math.round(100*a)]}getSource(){return this._source}setSource(t){this._source=t}toRgb(){const t=this.getSource();return`rgb(${t[0]},${t[1]},${t[2]})`}toRgba(){const t=this.getSource();return`rgba(${t[0]},${t[1]},${t[2]},${t[3]})`}toHsl(){const t=this.getSource(),e=this._rgbToHsl(t[0],t[1],t[2]);return`hsl(${e[0]},${e[1]}%,${e[2]}%)`}toHsla(){const t=this.getSource(),e=this._rgbToHsl(t[0],t[1],t[2]);return`hsla(${e[0]},${e[1]}%,${e[2]}%,${t[3]})`}toHex(){const[t,e,s]=this.getSource();return`${R(t)}${R(e)}${R(s)}`}toHexa(){const t=this.getSource();return`${this.toHex()}${R(Math.round(255*t[3]))}`}getAlpha(){return this.getSource()[3]}setAlpha(t){const e=this.getSource();return e[3]=t,this.setSource(e),this}toGrayscale(){const t=this.getSource(),e=parseInt((.3*t[0]+.59*t[1]+.11*t[2]).toFixed(0),10),s=t[3];return this.setSource([e,e,e,s]),this}toBlackWhite(t){const e=this.getSource(),s=e[3];let i=Math.round(.3*e[0]+.59*e[1]+.11*e[2]);return i=i<(t||127)?0:255,this.setSource([i,i,i,s]),this}overlayWith(t){t instanceof X||(t=new X(t));const[e,s,i,r]=this.getSource(),n=t.getSource(),[o,a,h]=[e,s,i].map(((t,e)=>Math.round(.5*t+.5*n[e])));return this.setSource([o,a,h,r]),this}static fromRgb(t){return X.fromRgba(t)}static fromRgba(t){return new X(X.sourceFromRgb(t))}static sourceFromRgb(t){const e=t.match(A);if(e){return[parseInt(e[1],10)/(/%$/.test(e[1])?100:1)*(/%$/.test(e[1])?255:1),parseInt(e[2],10)/(/%$/.test(e[2])?100:1)*(/%$/.test(e[2])?255:1),parseInt(e[3],10)/(/%$/.test(e[3])?100:1)*(/%$/.test(e[3])?255:1),e[4]?parseFloat(e[4]):1]}}static fromHsl(t){return X.fromHsla(t)}static fromHsla(t){return new X(X.sourceFromHsl(t))}static sourceFromHsl(t){const e=t.match(M);if(!e)return;const s=(parseFloat(e[1])%360+360)%360/360,i=parseFloat(e[2])/(/%$/.test(e[2])?100:1),r=parseFloat(e[3])/(/%$/.test(e[3])?100:1);let n,o,a;if(0===i)n=o=a=r;else{const t=r<=.5?r*(i+1):r+i-r*i,e=2*r-t;n=P(e,t,s+1/3),o=P(e,t,s),a=P(e,t,s-1/3)}return[Math.round(255*n),Math.round(255*o),Math.round(255*a),e[4]?parseFloat(e[4]):1]}static fromHex(t){return new X(X.sourceFromHex(t))}static sourceFromHex(t){if(t.match(F)){const e=t.slice(t.indexOf("#")+1),s=3===e.length||4===e.length,i=8===e.length||4===e.length,r=s?e.charAt(0)+e.charAt(0):e.substring(0,2),n=s?e.charAt(1)+e.charAt(1):e.substring(2,4),o=s?e.charAt(2)+e.charAt(2):e.substring(4,6),a=i?s?e.charAt(3)+e.charAt(3):e.substring(6,8):"FF";return[parseInt(r,16),parseInt(n,16),parseInt(o,16),parseFloat((parseInt(a,16)/255).toFixed(2))]}}}l.Color=X;const Y=(t,e,s)=>Math.max(t,Math.min(e,s)),B=t=>t&&((e,s,i)=>t(new X(e).toRgba(),s,i));class L extends T{constructor({startValue:t,endValue:e,byValue:s,easing:i=((t,e,s,i)=>e+s*(1-Math.cos(t/i*(Math.PI/2)))),onChange:r,onComplete:n,abort:o,...a}){const h=new X(t).getSource(),c=new X(e).getSource();super({...a,startValue:h,byValue:s?new X(s).setAlpha(Array.isArray(s)&&s[3]?s[3]:0).getSource():c.map(((t,e)=>t-h[e])),easing:i,onChange:B(r),onComplete:B(n),abort:B(o)})}calculate(t){const[e,s,i,r]=this.startValue.map(((e,s)=>this.easing(t,e,this.byValue[s],this.duration,s))),n=[e,s,i].map(Math.round);return{value:[...n,Y(0,r,1)],changeRatio:n.map(((t,e)=>0!==this.byValue[e]?Math.abs((t-this.startValue[e])/this.byValue[e]):0)).find((t=>0!==t))||0}}}const V=t=>{const e=(t=>Array.isArray(t.startValue)||Array.isArray(t.endValue)||Array.isArray(t.byValue))(t)?new E(t):new j(t);return e.start(),e};function I(t){let e=0,s=0;const i=l.document.documentElement,r=l.document.body||{scrollLeft:0,scrollTop:0};for(;t&&(t.parentNode||t.host)&&((t=t.parentNode||t.host)===l.document?(e=r.scrollLeft||i.scrollLeft||0,s=r.scrollTop||i.scrollTop||0):(e+=t.scrollLeft||0,s+=t.scrollTop||0),1!==t.nodeType||"fixed"!==t.style.position););return{left:e,top:s}}function $(t){return void 0!==t.onselectstart&&(t.onselectstart=()=>!1),t.style.userSelect="none",t}function G(t){const e=l.jsdomImplForWrapper(t);return e._canvas||e._image}function z(t){if(!l.isLikelyNode)return;const e=l.jsdomImplForWrapper(t);e&&(e._image=null,e._canvas=null,e._currentSrc=null,e._attributes=null,e._classList=null)}let W=0;const N=()=>W++,H=()=>l.document.createElement("canvas"),U=(t,e,s)=>t.toDataURL(`image/${e}`,s),q=t=>t*o,K=t=>t/o,J=(t,e,s)=>new y(t).transform(e,s),Z=t=>{const e=1/(t[0]*t[3]-t[1]*t[2]),s=[e*t[3],-e*t[1],-e*t[2],e*t[0],0,0],{x:i,y:r}=J(new y(t[4],t[5]),s,!0);return s[4]=-i,s[5]=-r,s},Q=(t,e,s)=>[t[0]*e[0]+t[2]*e[1],t[1]*e[0]+t[3]*e[1],t[0]*e[2]+t[2]*e[3],t[1]*e[2]+t[3]*e[3],s?0:t[0]*e[4]+t[2]*e[5]+t[4],s?0:t[1]*e[4]+t[3]*e[5]+t[5]],tt=t=>{const e=Math.atan2(t[1],t[0]),s=Math.pow(t[0],2)+Math.pow(t[1],2),i=Math.sqrt(s),r=(t[0]*t[3]-t[2]*t[1])/i,n=Math.atan2(t[0]*t[2]+t[1]*t[3],s);return{angle:K(e),scaleX:i,scaleY:r,skewX:K(n),skewY:0,translateX:t[4]||0,translateY:t[5]||0}},et=({angle:t})=>{if(!t)return a;const e=q(t),s=v(e),i=_(e);return[s,i,-i,s,0,0]},st=({scaleX:t=1,scaleY:e=1,flipX:s=!1,flipY:i=!1,skewX:r=0,skewY:n=0})=>{let o=a;return(1!==t||1!==e||s||i)&&(o=[s?-t:t,0,0,i?-e:e,0,0]),r&&(o=Q(o,[1,0,Math.tan(q(r)),1],!0)),n&&(o=Q(o,[1,Math.tan(q(n)),0,1],!0)),o};function it(t){return new RegExp("^("+t.join("|")+")\\b","i")}const rt={},nt="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:[eE][-+]?\\d+)?)",ot="(?:\\s+,?\\s*|,\\s*)",at=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+nt+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+nt+"))?\\s+(.*)"),ht={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform","image-rendering":"imageSmoothing"},ct={stroke:"strokeOpacity",fill:"fillOpacity"},lt="font-size",ut="clip-path";it(["path","circle","polygon","polyline","ellipse","rect","line","image","text"]),it(["symbol","image","marker","pattern","view","svg"]),it(["pattern","defs","symbol","metadata","clipPath","mask","desc"]);const dt=it(["symbol","g","a","svg","clipPath","defs"]);function gt(t,e,s){t[s]=Math.tan(q(e[0]))}const ft="(?:"+("(?:(matrix)\\s*\\(\\s*("+nt+")"+ot+"("+nt+")"+ot+"("+nt+")"+ot+"("+nt+")"+ot+"("+nt+")"+ot+"("+nt+")\\s*\\))")+"|"+("(?:(translate)\\s*\\(\\s*("+nt+")(?:"+ot+"("+nt+"))?\\s*\\))")+"|"+("(?:(scale)\\s*\\(\\s*("+nt+")(?:"+ot+"("+nt+"))?\\s*\\))")+"|"+("(?:(rotate)\\s*\\(\\s*("+nt+")(?:"+ot+"("+nt+")"+ot+"("+nt+"))?\\s*\\))")+"|"+("(?:(skewX)\\s*\\(\\s*("+nt+")\\s*\\))")+"|"+("(?:(skewY)\\s*\\(\\s*("+nt+")\\s*\\))")+")",pt=new RegExp("^\\s*(?:"+("(?:"+ft+"(?:"+ot+"*"+ft+")*)")+"?)\\s*$"),mt=new RegExp(ft,"g");function vt(t){let e=a.concat(),s=[];if(!t||t&&!pt.test(t))return e;t.replace(mt,(function(t){const i=new RegExp(ft).exec(t).filter((function(t){return!!t})),r=i[1],n=i.slice(2).map(parseFloat);switch(r){case"translate":!function(t,e){t[4]=e[0],2===e.length&&(t[5]=e[1])}(e,n);break;case"rotate":n[0]=q(n[0]),function(t,e){const s=v(e[0]),i=_(e[0]);let r=0,n=0;3===e.length&&(r=e[1],n=e[2]),t[0]=s,t[1]=i,t[2]=-i,t[3]=s,t[4]=r-(s*r-i*n),t[5]=n-(i*r+s*n)}(e,n);break;case"scale":!function(t,e){const s=e[0],i=2===e.length?e[1]:e[0];t[0]=s,t[3]=i}(e,n);break;case"skewX":gt(e,n,2);break;case"skewY":gt(e,n,1);break;case"matrix":e=n}s.push(e.concat()),e=a.concat()}));let i=s[0];for(;s.length>1;)s.shift(),i=Q(i,s[0]);return i}const _t=(t,e=[])=>e.reduce(((e,s)=>(s in t&&(e[s]=t[s]),e)),{}),yt=(t,e)=>parseFloat(Number(t).toFixed(e)),bt=(t,s)=>{const i=/\D{0,2}$/.exec(t),r=parseFloat(t);s||(s=16);const n=e.DPI;switch(i?.[0]){case"mm":return r*n/25.4;case"cm":return r*n/2.54;case"in":return r*n;case"pt":return r*n/72;case"pc":return r*n/72*12;case"em":return r*s;default:return r}},Ct=t=>"matrix("+t.map((t=>yt(t,e.NUM_FRACTION_DIGITS))).join(" ")+")",wt={x1:0,y1:0,x2:0,y2:0},xt={...wt,r1:0,r2:0};function Ot(t){return"linearGradient"===t.nodeName||"LINEARGRADIENT"===t.nodeName?"linear":"radial"}function St(t){return"userSpaceOnUse"===t.getAttribute("gradientUnits")?"pixels":"percentage"}const kt=/^(\d+\.\d+)%|(\d+)%$/;function Tt(t){return t&&kt.test(t)}function jt(t,e){const s="number"==typeof t?t:"string"==typeof t?parseFloat(t)/(Tt(t)?100:1):NaN;return Y(0,d(s,e),1)}const Et=/\s*;\s*/,Dt=/\s*:\s*/;function At(t,e){let s,i;const r=t.getAttribute("style");if(r){const t=r.split(Et);""===t[t.length-1]&&t.pop();for(let e=t.length;e--;){const[r,n]=t[e].split(Dt).map((t=>t.trim()));"stop-color"===r?s=n:"stop-opacity"===r&&(i=n)}}const n=new X(s||t.getAttribute("stop-color")||"rgb(0,0,0)");return{offset:jt(t.getAttribute("offset"),0),color:n.toRgb(),opacity:d(parseFloat(i||t.getAttribute("stop-opacity")||""),1)*n.getAlpha()*e}}function Mt(t,e){const s=[],i=t.getElementsByTagName("stop"),r=jt(e,1);for(let t=i.length;t--;)s.push(At(i[t],r));return s}function Ft(t,e){return t.getAttribute(e)}function Pt(t,e){return function(t,{width:e,height:s,gradientUnits:i}){let r;return Object.keys(t).reduce(((n,o)=>{const a=t[o];return"Infinity"===a?r=1:"-Infinity"===a?r=0:(r="string"==typeof a?parseFloat(a):a,"string"==typeof a&&Tt(a)&&(r*=.01,"pixels"===i&&("x1"!==o&&"x2"!==o&&"r2"!==o||(r*=e),"y1"!==o&&"y2"!==o||(r*=s)))),n[o]=r,n}),{})}("linear"===Ot(t)?function(t){return{x1:Ft(t,"x1")||0,y1:Ft(t,"y1")||0,x2:Ft(t,"x2")||"100%",y2:Ft(t,"y2")||0}}(t):function(t){return{x1:Ft(t,"fx")||Ft(t,"cx")||"50%",y1:Ft(t,"fy")||Ft(t,"cy")||"50%",r1:0,x2:Ft(t,"cx")||"50%",y2:Ft(t,"cy")||"50%",r2:Ft(t,"r")||"50%"}}(t),{...e,gradientUnits:St(t)})}class Rt{offsetX=0;offsetY=0;gradientTransform=null;gradientUnits;type;coords;colorStops;excludeFromExport;id;constructor({type:t="linear",gradientUnits:e="pixels",coords:s,colorStops:i=[],offsetX:r=0,offsetY:n=0,gradientTransform:o,id:a}){this.id=a?`${a}_${N()}`:N(),this.type=t,this.gradientUnits=e,this.gradientTransform=o||null,this.offsetX=r,this.offsetY=n,this.coords={..."radial"===this.type?xt:wt,...s},this.colorStops=i.slice()}addColorStop(t){for(const e in t){const s=new X(t[e]);this.colorStops.push({offset:parseFloat(e),color:s.toRgb(),opacity:s.getAlpha()})}return this}toObject(t){return{..._t(this,t),type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform}}toSVG(t,{additionalTransform:e}={}){const s=[],i=this.gradientTransform?this.gradientTransform.concat():a.concat(),r="pixels"===this.gradientUnits?"userSpaceOnUse":"objectBoundingBox",n=this.colorStops.map((t=>({...t}))).sort(((t,e)=>t.offset-e.offset));let o=-this.offsetX,h=-this.offsetY;"objectBoundingBox"===r?(o/=t.width,h/=t.height):(o+=t.width/2,h+=t.height/2),"path"===t.type&&"percentage"!==this.gradientUnits&&(o-=t.pathOffset.x,h-=t.pathOffset.y),i[4]-=o,i[5]-=h;const c=[`id="SVGID_${this.id}"`,`gradientUnits="${r}"`,`gradientTransform="${e?e+" ":""}${Ct(i)}"`,""].join(" ");if("linear"===this.type){const{x1:t,y1:e,x2:i,y2:r}=this.coords;s.push("<linearGradient ",c,' x1="',t,'" y1="',e,'" x2="',i,'" y2="',r,'">\n')}else if("radial"===this.type){const{x1:t,y1:e,x2:i,y2:r,r1:o,r2:a}=this.coords,h=o>a;s.push("<radialGradient ",c,' cx="',h?t:i,'" cy="',h?e:r,'" r="',h?o:a,'" fx="',h?i:t,'" fy="',h?r:e,'">\n'),h&&(n.reverse(),n.forEach((t=>{t.offset=1-t.offset})));const l=Math.min(o,a);if(l>0){const t=l/Math.max(o,a);n.forEach((e=>{e.offset+=t*(1-e.offset)}))}}return n.forEach((({color:t,offset:e,opacity:i})=>{s.push("<stop ",'offset="',100*e+"%",'" style="stop-color:',t,void 0!==i?";stop-opacity: "+i:";",'"/>\n')})),s.push("linear"===this.type?"</linearGradient>":"</radialGradient>","\n"),s.join("")}toLive(t){const e=this.coords,s="linear"===this.type?t.createLinearGradient(e.x1,e.y1,e.x2,e.y2):t.createRadialGradient(e.x1,e.y1,e.r1,e.x2,e.y2,e.r2);return this.colorStops.forEach((({color:t,opacity:e,offset:i})=>{s.addColorStop(i,void 0!==e?new X(t).setAlpha(e).toRgba():t)})),s}static fromElement(t,e,s){const i=St(t);return new this({id:t.getAttribute("id")||void 0,type:Ot(t),coords:Pt(t,{width:s.viewBoxWidth||s.width,height:s.viewBoxHeight||s.height}),colorStops:Mt(t,s.opacity),gradientUnits:i,gradientTransform:vt(t.getAttribute("gradientTransform")||""),..."pixels"===i?{offsetX:-e.left,offsetY:-e.top}:{offsetX:0,offsetY:0}})}}l.Gradient=Rt;const Xt="json",Yt="svg";const Bt=new class{[Xt];[Yt];constructor(){this[Xt]=new Map,this[Yt]=new Map}getClass(t){const e=this[Xt].get(t);if(!e)throw new Error(`No class registered for ${t}`);return e}setClass(t,e){this[Xt].set(e??t.prototype.type,t)}getSVGClass(t){return this[Yt].get(t)}setSVGClass(t,e){this[Yt].set(e??t.prototype.type,t)}};class Lt{type="pattern";repeat="repeat";offsetX=0;offsetY=0;crossOrigin="";patternTransform=null;source;excludeFromExport;id;constructor(t={}){this.id=N(),this.setOptions(t)}setOptions(t){for(const e in t)this[e]=t[e]}isImageSource(){return"string"==typeof this.source.src}isCanvasSource(){return"object"==typeof this.source&&this.source.toDataURL}sourceToString(){return this.isImageSource()?this.source.src:this.isCanvasSource()?this.source.toDataURL():""}toLive(t){return this.source&&(!this.isImageSource()||this.source.complete&&0!==this.source.naturalWidth&&0!==this.source.naturalHeight)?t.createPattern(this.source,this.repeat):""}toObject(t){return{..._t(this,t),type:"pattern",source:this.sourceToString(),repeat:this.repeat,crossOrigin:this.crossOrigin,offsetX:yt(this.offsetX,e.NUM_FRACTION_DIGITS),offsetY:yt(this.offsetY,e.NUM_FRACTION_DIGITS),patternTransform:this.patternTransform?this.patternTransform.concat():null}}toSVG({width:t,height:e}){const s=this.source,i=d(this.offsetX/t,0),r=d(this.offsetY/e,0),n="repeat-y"===this.repeat||"no-repeat"===this.repeat?1+Math.abs(i||0):d(s.width/t,0),o="repeat-x"===this.repeat||"no-repeat"===this.repeat?1+Math.abs(r||0):d(s.height/e,0);return[`<pattern id="SVGID_${this.id}" x="${i}" y="${r}" width="${n}" height="${o}">`,`<image x="0" y="0" width="${s.width}" height="${s.height}" xlink:href="${this.sourceToString()}"></image>`,"</pattern>",""].join("\n")}static async fromObject({source:t,...e},s){const i=await Vt(t,{...s,crossOrigin:e.crossOrigin});return new this({...e,source:i})}}Bt.setClass(Lt,"pattern"),l.Pattern=Lt;const Vt=(t,{signal:e,crossOrigin:s=null}={})=>new Promise((function(i,r){if(e&&e.aborted)return r(new Error("`options.signal` is in `aborted` state"));const n=l.document.createElement("img");let o;e&&(o=function(t){n.src="",r(t)},e.addEventListener("abort",o,{once:!0}));const a=function(){n.onload=n.onerror=null,o&&e?.removeEventListener("abort",o),i(n)};t?(n.onload=a,n.onerror=function(){o&&e?.removeEventListener("abort",o),r(new Error("Error loading "+n.src))},s&&(n.crossOrigin=s),n.src=t):a()})),It=(t,{signal:e,reviver:s=i}={})=>new Promise(((i,r)=>{const n=[];e&&e.addEventListener("abort",r,{once:!0}),Promise.all(t.map((t=>Bt.getClass(t.type).fromObject(t,{signal:e,reviver:s}).then((e=>(s(t,e),n.push(e),e)))))).then(i).catch((t=>{n.forEach((function(t){t.dispose&&t.dispose()})),r(t)})).finally((()=>{e&&e.removeEventListener("abort",r)}))})),$t=(t,{signal:e}={})=>new Promise(((s,i)=>{const r=[];e&&e.addEventListener("abort",i,{once:!0});const n=Object.values(t).map((t=>t?t.colorStops?new Rt(t):t.type?It([t],{signal:e}).then((([t])=>(r.push(t),t))):t.source?Lt.fromObject(t,{signal:e}).then((t=>(r.push(t),t))):t:t)),o=Object.keys(t);Promise.all(n).then((t=>t.reduce(((t,e,s)=>(t[o[s]]=e,t)),{}))).then(s).catch((t=>{r.forEach((t=>{t.dispose&&t.dispose()})),i(t)})).finally((()=>{e&&e.removeEventListener("abort",i)}))})),Gt=t=>!!t&&void 0!==t.toLive,zt=t=>!!t&&Array.isArray(t._objects),Wt=t=>!!t&&"activeSelection"===t.type,Nt=t=>!!t&&["i-text","textbox"].includes(t.type),Ht="Could not initialize `canvas` element";class Ut extends(f(m)){backgroundColor;backgroundImage;overlayColor;overlayImage;includeDefaultValues;stateful;renderOnAddRemove;controlsAboveOverlay;allowTouchScrolling;imageSmoothingEnabled;viewportTransform;backgroundVpt;overlayVpt;enableRetinaScaling;vptCoords;skipOffscreen;clipPath;lowerCanvasEl;contextContainer;width;height;destroyed;disposed;_originalCanvasStyle;renderAndResetBound;requestRenderAllBound;_offset;hasLostContext;nextRenderHandle;__cleanupTask;add(...t){const e=super.add(...t);return t.length>0&&this.renderOnAddRemove&&this.requestRenderAll(),e}insertAt(t,...e){const s=super.insertAt(t,...e);return e.length>0&&this.renderOnAddRemove&&this.requestRenderAll(),s}remove(...t){const e=super.remove(...t);return e.length>0&&this.renderOnAddRemove&&this.requestRenderAll(),e}_onObjectAdded(t){this.stateful&&t.setupState(),t.canvas&&t.canvas!==this&&(console.warn("fabric.Canvas: trying to add an object that belongs to a different canvas.\nResulting to default behavior: removing object from previous canvas and adding to new canvas"),t.canvas.remove(t)),t._set("canvas",this),t.setCoords(),this.fire("object:added",{target:t}),t.fire("added",{target:this})}_onObjectRemoved(t){t._set("canvas",void 0),this.fire("object:removed",{target:t}),t.fire("removed",{target:this})}_onStackOrderChanged(){this.renderOnAddRemove&&this.requestRenderAll()}constructor(t,e={}){super(),this._init(t,e)}_init(t,e={}){this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(t,e),this._initRetinaScaling(),this.calcViewportBoundaries()}_initStatic(t,e={}){this._objects=[],this._createLowerCanvas(t),this._originalCanvasStyle=this.lowerCanvasEl.style.cssText,this._initOptions(e),this.calcOffset()}_isRetinaScaling(){return e.devicePixelRatio>1&&this.enableRetinaScaling}getRetinaScaling(){return this._isRetinaScaling()?Math.max(1,e.devicePixelRatio):1}_initRetinaScaling(){this._isRetinaScaling()&&this.__initRetinaScaling(this.lowerCanvasEl,this.contextContainer)}__initRetinaScaling(t,s){const i=e.devicePixelRatio;t.setAttribute("width",(this.width*i).toString()),t.setAttribute("height",(this.height*i).toString()),s.scale(i,i)}calcOffset(){return this._offset=function(t){let e={left:0,top:0};const s=t&&t.ownerDocument,i={left:0,top:0},r={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!s)return i;const n=l.document.defaultView.getComputedStyle(t,null);for(const t in r)i[r[t]]+=parseInt(n[t],10)||0;const o=s.documentElement;void 0!==t.getBoundingClientRect&&(e=t.getBoundingClientRect());const a=I(t);return{left:e.left+a.left-(o.clientLeft||0)+i.left,top:e.top+a.top-(o.clientTop||0)+i.top}}(this.lowerCanvasEl)}_createCanvasElement(){const t=H();if(!t)throw new Error(Ht);if(void 0===t.getContext)throw new Error(Ht);return t}_initOptions(t={}){const e=this.lowerCanvasEl;this.set(t),this.width=this.width||e.width||0,this.height=this.height||e.height||0,this.lowerCanvasEl.style&&(e.width=this.width,e.height=this.height,e.style.width=this.width+"px",e.style.height=this.height+"px",this.viewportTransform=[...this.viewportTransform])}_createLowerCanvas(t){var e;if((e=t)&&void 0!==e.getContext?this.lowerCanvasEl=t:this.lowerCanvasEl=l.document.getElementById(t)||t||this._createCanvasElement(),this.lowerCanvasEl.hasAttribute("data-fabric"))throw new Error("fabric.js: trying to initialize a canvas that has already been initialized");this.lowerCanvasEl.classList.add("lower-canvas"),this.lowerCanvasEl.setAttribute("data-fabric","main"),this.contextContainer=this.lowerCanvasEl.getContext("2d")}getWidth(){return this.width}getHeight(){return this.height}setWidth(t,e){return this.setDimensions({width:t},e)}setHeight(t,e){return this.setDimensions({height:t},e)}setDimensions(t,{cssOnly:e=!1,backstoreOnly:s=!1}={}){Object.entries(t).forEach((([t,i])=>{let r=`${i}`;e||(this._setBackstoreDimension(t,i),r+="px",this.hasLostContext=!0),s||this._setCssDimension(t,r)})),this._initRetinaScaling(),this.calcOffset(),e||this.requestRenderAll()}_setBackstoreDimension(t,e){this.lowerCanvasEl[t]=e,this[t]=e}_setCssDimension(t,e){this.lowerCanvasEl.style[t]=e}getZoom(){return this.viewportTransform[0]}setViewportTransform(t){const e=this._activeObject,s=this.backgroundImage,i=this.overlayImage,r=this._objects.length;this.viewportTransform=t;for(let t=0;t<r;t++){const e=this._objects[t];e.group||e.setCoords()}e&&e.setCoords(),s&&s.setCoords(),i&&i.setCoords(),this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll()}zoomToPoint(t,e){const s=t,i=[...this.viewportTransform],r=J(t,Z(i));i[0]=e,i[3]=e;const n=J(r,i);i[4]+=s.x-n.x,i[5]+=s.y-n.y,this.setViewportTransform(i)}setZoom(t){this.zoomToPoint(new y(0,0),t)}absolutePan(t){const e=[...this.viewportTransform];return e[4]=-t.x,e[5]=-t.y,this.setViewportTransform(e)}relativePan(t){return this.absolutePan(new y(-t.x-this.viewportTransform[4],-t.y-this.viewportTransform[5]))}getElement(){return this.lowerCanvasEl}clearContext(t){t.clearRect(0,0,this.width,this.height)}getContext(){return this.contextContainer}clear(){this.remove(...this.getObjects()),this.backgroundImage=null,this.overlayImage=null,this.backgroundColor="",this.overlayColor="",this.clearContext(this.contextContainer),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll()}renderAll(){this.cancelRequestedRender(),this.destroyed||this.renderCanvas(this.contextContainer,this._objects)}renderAndReset(){this.nextRenderHandle=0,this.renderAll()}requestRenderAll(){this.nextRenderHandle||this.disposed||this.destroyed||(this.nextRenderHandle=x(this.renderAndResetBound))}calcViewportBoundaries(){const t=this.width,e=this.height,s=Z(this.viewportTransform),i=J({x:0,y:0},s),r=J({x:t,y:e},s),n=i.min(r),o=i.max(r);return this.vptCoords={tl:n,tr:new y(o.x,n.y),bl:new y(n.x,o.y),br:o}}cancelRequestedRender(){var t;this.nextRenderHandle&&(t=this.nextRenderHandle,w.call(l.window,t),this.nextRenderHandle=0)}renderCanvas(t,e){if(this.destroyed)return;const s=this.viewportTransform,i=this.clipPath;this.calcViewportBoundaries(),this.clearContext(t),t.imageSmoothingEnabled=this.imageSmoothingEnabled,t.patternQuality="best",this.fire("before:render",{ctx:t}),this._renderBackground(t),t.save(),t.transform(s[0],s[1],s[2],s[3],s[4],s[5]),this._renderObjects(t,e),t.restore(),!this.controlsAboveOverlay&&this.interactive&&this.drawControls(t),i&&(i._set("canvas",this),i.shouldCache(),i._transformDone=!0,i.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(t,i)),this._renderOverlay(t),this.controlsAboveOverlay&&this.interactive&&this.drawControls(t),this.fire("after:render",{ctx:t}),this.__cleanupTask&&(this.__cleanupTask(),this.__cleanupTask=void 0)}drawClipPathOnCanvas(t,e){const s=this.viewportTransform;t.save(),t.transform(...s),t.globalCompositeOperation="destination-in",e.transform(t),t.scale(1/e.zoomX,1/e.zoomY),t.drawImage(e._cacheCanvas,-e.cacheTranslationX,-e.cacheTranslationY),t.restore()}_renderObjects(t,e){for(let s=0,i=e.length;s<i;++s)e[s]&&e[s].render(t)}_renderBackgroundOrOverlay(t,e){const s=this[`${e}Color`],i=this[`${e}Image`],r=this.viewportTransform,n=this[`${e}Vpt`];if(!s&&!i)return;const o=Gt(s);if(s){if(t.save(),t.beginPath(),t.moveTo(0,0),t.lineTo(this.width,0),t.lineTo(this.width,this.height),t.lineTo(0,this.height),t.closePath(),t.fillStyle=o?s.toLive(t):s,n&&t.transform(...r),o){t.transform(1,0,0,1,s.offsetX||0,s.offsetY||0);const e=s.gradientTransform||s.patternTransform;e&&t.transform(...e)}t.fill(),t.restore()}i&&(t.save(),n&&t.transform(...r),i.render(t),t.restore())}_renderBackground(t){this._renderBackgroundOrOverlay(t,"background")}_renderOverlay(t){this._renderBackgroundOrOverlay(t,"overlay")}getCenter(){return{top:this.height/2,left:this.width/2}}getCenterPoint(){return new y(this.width/2,this.height/2)}centerObjectH(t){return this._centerObject(t,new y(this.getCenterPoint().x,t.getCenterPoint().y))}centerObjectV(t){return this._centerObject(t,new y(t.getCenterPoint().x,this.getCenterPoint().y))}centerObject(t){return this._centerObject(t,this.getCenterPoint())}viewportCenterObject(t){return this._centerObject(t,this.getVpCenter())}viewportCenterObjectH(t){return this._centerObject(t,new y(this.getVpCenter().x,t.getCenterPoint().y))}viewportCenterObjectV(t){return this._centerObject(t,new y(t.getCenterPoint().x,this.getVpCenter().y))}getVpCenter(){return J(this.getCenterPoint(),Z(this.viewportTransform))}_centerObject(t,e){t.setXY(e,"center","center"),t.setCoords(),this.renderOnAddRemove&&this.requestRenderAll()}toDatalessJSON(t){return this.toDatalessObject(t)}toObject(t){return this._toObjectMethod("toObject",t)}toJSON(){return this.toObject()}toDatalessObject(t){return this._toObjectMethod("toDatalessObject",t)}_toObjectMethod(t,e){const s=this.clipPath,i=s&&!s.excludeFromExport?this._toObject(s,t,e):null;return{version:c,..._t(this,e),objects:this._objects.filter((t=>!t.excludeFromExport)).map((s=>this._toObject(s,t,e))),...this.__serializeBgOverlay(t,e),...i?{clipPath:i}:null}}_toObject(t,e,s){let i;this.includeDefaultValues||(i=t.includeDefaultValues,t.includeDefaultValues=!1);const r=t[e](s);return this.includeDefaultValues||(t.includeDefaultValues=!!i),r}__serializeBgOverlay(t,e){const s={},i=this.backgroundImage,r=this.overlayImage,n=this.backgroundColor,o=this.overlayColor;return Gt(n)?n.excludeFromExport||(s.background=n.toObject(e)):n&&(s.background=n),Gt(o)?o.excludeFromExport||(s.overlay=o.toObject(e)):o&&(s.overlay=o),i&&!i.excludeFromExport&&(s.backgroundImage=this._toObject(i,t,e)),r&&!r.excludeFromExport&&(s.overlayImage=this._toObject(r,t,e)),s}svgViewportTransformation;toSVG(t={},e){t.reviver=e;const s=[];return this._setSVGPreamble(s,t),this._setSVGHeader(s,t),this.clipPath&&s.push(`<g clip-path="url(#${this.clipPath.clipPathId})" >\n`),this._setSVGBgOverlayColor(s,"background"),this._setSVGBgOverlayImage(s,"backgroundImage",e),this._setSVGObjects(s,e),this.clipPath&&s.push("</g>\n"),this._setSVGBgOverlayColor(s,"overlay"),this._setSVGBgOverlayImage(s,"overlayImage",e),s.push("</svg>"),s.join("")}_setSVGPreamble(t,e){e.suppressPreamble||t.push('<?xml version="1.0" encoding="',e.encoding||"UTF-8",'" standalone="no" ?>\n','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')}_setSVGHeader(t,s){const i=s.width||`${this.width}`,r=s.height||`${this.height}`,n=e.NUM_FRACTION_DIGITS,o=s.viewBox;let a;if(o)a=`viewBox="${o.x} ${o.y} ${o.width} ${o.height}" `;else if(this.svgViewportTransformation){const t=this.viewportTransform;a=`viewBox="${yt(-t[4]/t[0],n)} ${yt(-t[5]/t[3],n)} ${yt(this.width/t[0],n)} ${yt(this.height/t[3],n)}" `}else a=`viewBox="0 0 ${this.width} ${this.height}" `;t.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',i,'" ','height="',r,'" ',a,'xml:space="preserve">\n',"<desc>Created with Fabric.js ",c,"</desc>\n","<defs>\n",this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(s),"</defs>\n")}createSVGClipPathMarkup(t){const e=this.clipPath;return e?(e.clipPathId=`CLIPPATH_${N()}`,'<clipPath id="'+e.clipPathId+'" >\n'+this.clipPath.toClipPathSVG(t.reviver)+"</clipPath>\n"):""}createSVGRefElementsMarkup(){return["background","overlay"].map((t=>{const e=this[`${t}Color`];if(Gt(e)){const s=this[`${t}Vpt`],i=this.viewportTransform,r={width:this.width/(s?i[0]:1),height:this.height/(s?i[3]:1)};return e.toSVG(r,{additionalTransform:s?Ct(i):""})}})).join("")}createSVGFontFacesMarkup(){const t=[],s={},i=e.fontPaths;this._objects.forEach((function e(s){t.push(s),zt(s)&&s._objects.forEach(e)})),t.forEach((t=>{if(!(e=t)||!e.type.includes("text"))return;var e;let r=t.fontFamily;!s[r]&&i[r]&&(s[r]=!0,t.styles&&Object.values(t.styles).forEach((t=>{Object.values(t).forEach((t=>{r=t.fontFamily,!s[r]&&i[r]&&(s[r]=!0)}))})))}));const r=Object.keys(s).map((t=>`\t\t@font-face {\n\t\t\tfont-family: '${t}';\n\t\t\tsrc: url('${i[t]}');\n\t\t}\n`)).join("");return r?`\t<style type="text/css"><![CDATA[\n${r}]]></style>\n`:""}_setSVGObjects(t,e){this.forEachObject((s=>{s.excludeFromExport||this._setSVGObject(t,s,e)}))}_setSVGObject(t,e,s){t.push(e.toSVG(s))}_setSVGBgOverlayImage(t,e,s){const i=this[e];i&&!i.excludeFromExport&&i.toSVG&&t.push(i.toSVG(s))}_setSVGBgOverlayColor(t,e){const s=this[`${e}Color`];if(s)if(Gt(s)){const i=s.repeat||"",r=this.width,n=this.height,o=this[`${e}Vpt`]?Ct(Z(this.viewportTransform)):"";t.push(`<rect transform="${o} translate(${r/2},${n/2})" x="${s.offsetX-r/2}" y="${s.offsetY-n/2}" width="${"repeat-y"===i||"no-repeat"===i?s.source.width:r}" height="${"repeat-x"===i||"no-repeat"===i?s.source.height:n}" fill="url(#SVGID_${s.id})"></rect>\n`)}else t.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',s,'"',"></rect>\n")}loadFromJSON(t,e,{signal:s}={}){if(!t)return Promise.reject(new Error("fabric.js: `json` is undefined"));const i="string"==typeof t?JSON.parse(t):t,{objects:r=[],backgroundImage:n,background:o,overlayImage:a,overlay:h,clipPath:c}=i,l=this.renderOnAddRemove;return this.renderOnAddRemove=!1,Promise.all([It(r,{reviver:e,signal:s}),$t({backgroundImage:n,backgroundColor:o,overlayImage:a,overlayColor:h,clipPath:c},{signal:s})]).then((([t,e])=>(this.clear(),this.add(...t),this.set(i),this.set(e),this.renderOnAddRemove=l,this)))}clone(t){const e=this.toObject(t);return this.cloneWithoutData().loadFromJSON(e)}cloneWithoutData(){const t=H();return t.width=this.width,t.height=this.height,new Ut(t)}toDataURL(t={}){const{format:e="png",quality:s=1,multiplier:i=1,enableRetinaScaling:r=!1}=t,n=i*(r?this.getRetinaScaling():1);return U(this.toCanvasElement(n,t),e,s)}toCanvasElement(t=1,{width:e,height:s,left:i,top:r,filter:n}={}){const o=(e||this.width)*t,a=(s||this.height)*t,h=this.getZoom(),c=this.width,l=this.height,u=h*t,d=this.viewportTransform,g=(d[4]-(i||0))*t,f=(d[5]-(r||0))*t,p=this.interactive,m=[u,0,0,u,g,f],v=this.enableRetinaScaling,_=H(),y=this.contextTop,b=n?this._objects.filter(n):this._objects;return _.width=o,_.height=a,this.contextTop=null,this.enableRetinaScaling=!1,this.interactive=!1,this.viewportTransform=m,this.width=o,this.height=a,this.calcViewportBoundaries(),this.renderCanvas(_.getContext("2d"),b),this.viewportTransform=d,this.width=c,this.height=l,this.calcViewportBoundaries(),this.interactive=p,this.enableRetinaScaling=v,this.contextTop=y,_}dispose(){return this.disposed=!0,new Promise(((t,e)=>{const s=()=>{this.destroy(),t(!0)};s.kill=e,this.__cleanupTask&&this.__cleanupTask.kill("aborted"),this.destroyed?t(!1):this.nextRenderHandle?this.__cleanupTask=s:s()}))}destroy(){this.destroyed=!0,this.cancelRequestedRender(),this.forEachObject((t=>t.dispose())),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this.contextContainer=null;const t=this.lowerCanvasEl;this.lowerCanvasEl=void 0,t.classList.remove("lower-canvas"),t.removeAttribute("data-fabric"),t.setAttribute("width",`${this.width}`),t.setAttribute("height",`${this.height}`),t.style.cssText=this._originalCanvasStyle||"",this._originalCanvasStyle=void 0,z(t)}toString(){return`#<Canvas (${this.complexity()}): { objects: ${this._objects.length} }>`}}Object.assign(Ut.prototype,{backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!1,renderOnAddRemove:!0,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:a.concat(),backgroundVpt:!0,overlayVpt:!0,enableRetinaScaling:!0,svgViewportTransformation:!0,skipOffscreen:!0,clipPath:void 0}),l.isLikelyNode&&Object.assign(Ut.prototype,{createPNGStream(){const t=G(this.lowerCanvasEl);return t&&t.createPNGStream()},createJPEGStream(t){const e=G(this.lowerCanvasEl);return e&&e.createJPEGStream(t)}}),l.StaticCanvas=Ut;const qt={left:-.5,top:-.5,center:0,bottom:.5,right:.5},Kt=t=>"string"==typeof t?qt[t]:t-.5,Jt=t=>{if(0===t.length)return{left:0,top:0,width:0,height:0};const{min:e,max:s}=t.reduce((({min:t,max:e},s)=>({min:t.min(s),max:e.max(s)})),{min:new y(t[0]),max:new y(t[0])}),i=s.subtract(e);return{left:e.x,top:e.y,width:i.x,height:i.y}},Zt=(t,e)=>{const{translateX:s,translateY:i,scaleX:r,scaleY:n,...o}=tt(e),a=new y(s,i);t.flipX=!1,t.flipY=!1,Object.assign(t,o),t.set({scaleX:r,scaleY:n}),t.setPositionByOrigin(a,"center","center")},Qt=t=>({scaleX:t.scaleX,scaleY:t.scaleY,skewX:t.skewX,skewY:t.skewY,angle:t.angle,left:t.left,flipX:t.flipX,flipY:t.flipY,top:t.top}),te=(t,e,s)=>{const i=t/2,r=e/2,n=st(s),o=[new y(-i,-r),new y(i,-r),new y(-i,r),new y(i,r)].map((t=>t.transform(n))),a=Jt(o);return new y(a.width,a.height)};function ee(t,e){if(e){if(e.toLive)return`${t}: url(#SVGID_${e.id}); `;{const s=new X(e),i=s.getAlpha();let r=`${t}: ${s.toRgb()}; `;return 1!==i&&(r+=`${t}-opacity: ${i.toString()}; `),r}}return`${t}: none; `}const se=(t,e,s)=>{const i=new y(t).subtract(e),r=new y(t).subtract(s);return Math.sign(i.x)!==Math.sign(r.x)||Math.sign(i.y)!==Math.sign(r.y)};class ie{points;status;constructor(t){this.status=t,this.points=[]}contains(t){return this.points.some((e=>e.eq(t)))}append(...t){return this.points=this.points.concat(t.filter((t=>!this.contains(t)))),this}static intersectLineLine(t,e,s,i,r=!0,n=!0){let o;const a=(i.x-s.x)*(t.y-s.y)-(i.y-s.y)*(t.x-s.x),h=(e.x-t.x)*(t.y-s.y)-(e.y-t.y)*(t.x-s.x),c=(i.y-s.y)*(e.x-t.x)-(i.x-s.x)*(e.y-t.y);if(0!==c){const s=a/c,i=h/c;(r||0<=s&&s<=1)&&(n||0<=i&&i<=1)?(o=new ie("Intersection"),o.append(new y(t.x+s*(e.x-t.x),t.y+s*(e.y-t.y)))):o=new ie}else if(0===a||0===h){const a=r||n||se(t,s,i)||se(e,s,i)||se(s,t,e)||se(i,t,e);o=new ie(a?"Coincident":void 0)}else o=new ie("Parallel");return o}static intersectSegmentLine(t,e,s,i){return ie.intersectLineLine(t,e,s,i,!1,!0)}static intersectSegmentSegment(t,e,s,i){return ie.intersectLineLine(t,e,s,i,!1,!1)}static intersectLinePolygon(t,e,s,i=!0){const r=new ie,n=s.length;for(let o,a,h,c=0;c<n;c++){if(o=s[c],a=s[(c+1)%n],h=ie.intersectLineLine(t,e,o,a,i,!1),"Coincident"===h.status)return h;r.append(...h.points)}return r.points.length>0&&(r.status="Intersection"),r}static intersectSegmentPolygon(t,e,s){return ie.intersectLinePolygon(t,e,s,!1)}static intersectPolygonPolygon(t,e){const s=new ie,i=t.length,r=[];for(let n=0;n<i;n++){const o=t[n],a=t[(n+1)%i],h=ie.intersectSegmentPolygon(o,a,e);"Coincident"===h.status?(r.push(h),s.append(o,a)):s.append(...h.points)}return r.length>0&&r.length===t.length?new ie("Coincident"):(s.points.length>0&&(s.status="Intersection"),s)}static intersectPolygonRectangle(t,e,s){const i=e.min(s),r=e.max(s),n=new y(r.x,i.y),o=new y(i.x,r.y);return ie.intersectPolygonPolygon(t,[i,n,r,o])}}l.Intersection=ie;class re extends m{top;left;width;height;scaleX;scaleY;skewX;skewY;originX;originY;angle;strokeWidth;strokeUniform;group;_originalOriginX;_originalOriginY;_getTransformedDimensions(t={}){const e={scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,width:this.width,height:this.height,strokeWidth:this.strokeWidth,...t},s=e.strokeWidth;let i=s,r=0;this.strokeUniform&&(i=0,r=s);const n=e.width+i,o=e.height+i;let a;return a=0===e.skewX&&0===e.skewY?new y(n*e.scaleX,o*e.scaleY):te(n,o,e),a.scalarAdd(r)}translateToGivenOrigin(t,e,s,i,r){let n=t.x,o=t.y;const a=Kt(i)-Kt(e),h=Kt(r)-Kt(s);if(a||h){const t=this._getTransformedDimensions();n+=a*t.x,o+=h*t.y}return new y(n,o)}translateToCenterPoint(t,e,s){const i=this.translateToGivenOrigin(t,e,s,"center","center");return this.angle?i.rotate(q(this.angle),t):i}translateToOriginPoint(t,e,s){const i=this.translateToGivenOrigin(t,"center","center",e,s);return this.angle?i.rotate(q(this.angle),t):i}getCenterPoint(){const t=this.getRelativeCenterPoint();return this.group?J(t,this.group.calcTransformMatrix()):t}getRelativeCenterPoint(){return this.translateToCenterPoint(new y(this.left,this.top),this.originX,this.originY)}getPointByOrigin(t,e){return this.translateToOriginPoint(this.getRelativeCenterPoint(),t,e)}setPositionByOrigin(t,e,s){const i=this.translateToCenterPoint(t,e,s),r=this.translateToOriginPoint(i,this.originX,this.originY);this.set({left:r.x,top:r.y})}_setOriginToCenter(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;const t=this.getRelativeCenterPoint();this.originX="center",this.originY="center",this.left=t.x,this.top=t.y}_resetOrigin(){if(void 0!==this._originalOriginX&&void 0!==this._originalOriginY){const t=this.translateToOriginPoint(this.getRelativeCenterPoint(),this._originalOriginX,this._originalOriginY);this.left=t.x,this.top=t.y,this.originX=this._originalOriginX,this.originY=this._originalOriginY,this._originalOriginX=void 0,this._originalOriginY=void 0}}_getLeftTopCoords(){return this.translateToOriginPoint(this.getRelativeCenterPoint(),"left","top")}}class ne extends re{flipX;flipY;padding;aCoords;lineCoords;ownMatrixCache;matrixCache;canvas;getX(){return this.getXY().x}setX(t){this.setXY(this.getXY().setX(t))}getY(){return this.getXY().y}setY(t){this.setXY(this.getXY().setY(t))}getRelativeX(){return this.left}setRelativeX(t){this.left=t}getRelativeY(){return this.top}setRelativeY(t){this.top=t}getXY(){const t=this.getRelativeXY();return this.group?J(t,this.group.calcTransformMatrix()):t}setXY(t,e,s){this.group&&(t=J(t,Z(this.group.calcTransformMatrix()))),this.setRelativeXY(t,e,s)}getRelativeXY(){return new y(this.left,this.top)}setRelativeXY(t,e,s){this.setPositionByOrigin(t,e||this.originX,s||this.originY)}_getCoords(t=!1,e=!1){return e?t?this.calcACoords():this.calcLineCoords():(this.aCoords||(this.aCoords=this.calcACoords()),this.lineCoords||(this.lineCoords=this.calcLineCoords()),t?this.aCoords:this.lineCoords)}getCoords(t=!1,e=!1){const{tl:s,tr:i,br:r,bl:n}=this._getCoords(t,e),o=[s,i,r,n];if(this.group){const t=this.group.calcTransformMatrix();return o.map((e=>J(e,t)))}return o}intersectsWithRect(t,e,s,i){const r=this.getCoords(s,i);return"Intersection"===ie.intersectPolygonRectangle(r,t,e).status}intersectsWithObject(t,e=!1,s=!1){const i=ie.intersectPolygonPolygon(this.getCoords(e,s),t.getCoords(e,s));return"Intersection"===i.status||"Coincident"===i.status||t.isContainedWithinObject(this,e,s)||this.isContainedWithinObject(t,e,s)}isContainedWithinObject(t,e=!1,s=!1){const i=this.getCoords(e,s),r=e?t.aCoords:t.lineCoords,n=t._getImageLines(r);for(let e=0;e<4;e++)if(!t.containsPoint(i[e],n))return!1;return!0}isContainedWithinRect(t,e,s,i){const r=this.getBoundingRect(s,i);return r.left>=t.x&&r.left+r.width<=e.x&&r.top>=t.y&&r.top+r.height<=e.y}isOverlapping(t){return this.intersectsWithObject(t)||this.isContainedWithinObject(t)||t.isContainedWithinObject(this)}containsPoint(t,e,s=!1,i=!1){const r=this._getCoords(s,i),n=e||this._getImageLines(r),o=this._findCrossPoints(t,n);return 0!==o&&o%2==1}isOnScreen(t=!1){if(!this.canvas)return!1;const{tl:e,br:s}=this.canvas.vptCoords;return!!this.getCoords(!0,t).some((t=>t.x<=s.x&&t.x>=e.x&&t.y<=s.y&&t.y>=e.y))||(!!this.intersectsWithRect(e,s,!0,t)||this._containsCenterOfCanvas(e,s,t))}_containsCenterOfCanvas(t,e,s){const i=t.midPointFrom(e);return this.containsPoint(i,void 0,!0,s)}isPartiallyOnScreen(t){if(!this.canvas)return!1;const{tl:e,br:s}=this.canvas.vptCoords;if(this.intersectsWithRect(e,s,!0,t))return!0;return this.getCoords(!0,t).every((t=>(t.x>=s.x||t.x<=e.x)&&(t.y>=s.y||t.y<=e.y)))&&this._containsCenterOfCanvas(e,s,t)}_getImageLines({tl:t,tr:e,bl:s,br:i}){return{topline:{o:t,d:e},rightline:{o:e,d:i},bottomline:{o:i,d:s},leftline:{o:s,d:t}}}_findCrossPoints(t,e){let s=0;for(const i in e){let r;const n=e[i];if(!(n.o.y<t.y&&n.d.y<t.y)&&!(n.o.y>=t.y&&n.d.y>=t.y)){if(n.o.x===n.d.x&&n.o.x>=t.x)r=n.o.x;else{const e=0,s=(n.d.y-n.o.y)/(n.d.x-n.o.x);r=-(t.y-e*t.x-(n.o.y-s*n.o.x))/(e-s)}if(r>=t.x&&(s+=1),2===s)break}}return s}getBoundingRect(t,e){return Jt(this.getCoords(t,e))}getScaledWidth(){return this._getTransformedDimensions().x}getScaledHeight(){return this._getTransformedDimensions().y}scale(t){this._set("scaleX",t),this._set("scaleY",t),this.setCoords()}scaleToWidth(t,e){const s=this.getBoundingRect(e).width/this.getScaledWidth();return this.scale(t/this.width/s)}scaleToHeight(t,e=!1){const s=this.getBoundingRect(e).height/this.getScaledHeight();return this.scale(t/this.height/s)}getCanvasRetinaScaling(){return this.canvas?.getRetinaScaling()||1}getTotalAngle(){return this.group?tt(this.calcTransformMatrix()).angle:this.angle}calcLineCoords(){const t=this.getViewportTransform(),e=this.padding,s=q(this.getTotalAngle()),i=v(s)*e,r=_(s)*e,n=i+r,o=i-r,{tl:a,tr:h,bl:c,br:l}=this.calcACoords(),u={tl:J(a,t),tr:J(h,t),bl:J(c,t),br:J(l,t)};return e&&(u.tl.x-=o,u.tl.y-=n,u.tr.x+=n,u.tr.y-=o,u.bl.x-=n,u.bl.y+=o,u.br.x+=o,u.br.y+=n),u}getViewportTransform(){return this.canvas?.viewportTransform||a.concat()}calcACoords(){const t=et({angle:this.angle}),e=this.getRelativeCenterPoint(),s=[1,0,0,1,e.x,e.y],i=Q(s,t),r=this._getTransformedDimensions(),n=r.x/2,o=r.y/2;return{tl:J({x:-n,y:-o},i),tr:J({x:n,y:-o},i),bl:J({x:-n,y:o},i),br:J({x:n,y:o},i)}}setCoords(){this.aCoords=this.calcACoords(),this.lineCoords=this.group?this.aCoords:this.calcLineCoords()}transformMatrixKey(t=!1){const e="_";let s="";return!t&&this.group&&(s=this.group.transformMatrixKey(t)+e),s+this.top+e+this.left+e+this.scaleX+e+this.scaleY+e+this.skewX+e+this.skewY+e+this.angle+e+this.originX+e+this.originY+e+this.width+e+this.height+e+this.strokeWidth+this.flipX+this.flipY}calcTransformMatrix(t=!1){let e=this.calcOwnMatrix();if(t||!this.group)return e;const s=this.transformMatrixKey(t),i=this.matrixCache;return i&&i.key===s?i.value:(this.group&&(e=Q(this.group.calcTransformMatrix(!1),e)),this.matrixCache={key:s,value:e},e)}calcOwnMatrix(){const t=this.transformMatrixKey(!0),e=this.ownMatrixCache;if(e&&e.key===t)return e.value;const s=this.getRelativeCenterPoint(),i=(({translateX:t=0,translateY:e=0,angle:s=0,...i})=>{let r=[1,0,0,1,t,e];s&&(r=Q(r,et({angle:s})));const n=st(i);return n!==a&&(r=Q(r,n)),r})({angle:this.angle,translateX:s.x,translateY:s.y,scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,flipX:this.flipX,flipY:this.flipY});return this.ownMatrixCache={key:t,value:i},i}_getNonTransformedDimensions(){return new y(this.width,this.height).scalarAdd(this.strokeWidth)}_calculateCurrentDimensions(t){return this._getTransformedDimensions(t).transform(this.getViewportTransform(),!0).scalarAdd(2*this.padding)}}class oe extends ne{isDescendantOf(t){let e=this.group||this.canvas;for(;e;){if(t===e)return!0;if(e instanceof l.StaticCanvas)return!1;e=e.group||e.canvas}return!1}getAncestors(t){const e=[];let s=this.group||(t?void 0:this.canvas);for(;s;)e.push(s),s=s.group||(t?void 0:s.canvas);return e}findCommonAncestors(t,e){if(this===t)return{fork:[],otherFork:[],common:[this,...this.getAncestors(e)]};const s=this.getAncestors(e),i=t.getAncestors(e);if(0===s.length&&i.length>0&&this===i[i.length-1])return{fork:[],otherFork:[t,...i.slice(0,i.length-1)],common:[this]};for(let e,r=0;r<s.length;r++){if(e=s[r],e===t)return{fork:[this,...s.slice(0,r)],otherFork:[],common:s.slice(r)};for(let n=0;n<i.length;n++){if(this===i[n])return{fork:[],otherFork:[t,...i.slice(0,n)],common:[this,...s]};if(e===i[n])return{fork:[this,...s.slice(0,r)],otherFork:[t,...i.slice(0,n)],common:s.slice(r)}}}return{fork:[this,...s],otherFork:[t,...i],common:[]}}hasCommonAncestors(t,e){const s=this.findCommonAncestors(t,e);return s&&!!s.common.length}isInFrontOf(t){if(this===t)return;const e=this.findCommonAncestors(t);if(!e)return;if(e.fork.includes(t))return!0;if(e.otherFork.includes(this))return!1;const s=e.common[0];if(!s)return;const i=e.fork.pop(),r=e.otherFork.pop(),n=s._objects.indexOf(i),o=s._objects.indexOf(r);return n>-1&&n>o}}class ae extends oe{FX_DURATION;colorProperties;animate(t,e,s){const i="string"==typeof t?{[t]:e}:t,r=Object.keys(i),n="string"==typeof t?s:e;return r.map(((t,e)=>this._animate(t,i[t],e===r.length-1?n:{...n,onChange:void 0,onComplete:void 0})))}_animate(t,e,s={}){const i=t.split("."),r=this.colorProperties.includes(i[i.length-1]),n=i.reduce(((t,e)=>t[e]),this);r||"string"!=typeof e||(e=e.includes("=")?n+parseFloat(e.replace("=","")):parseFloat(e));const o={target:this,startValue:s.startValue??s.from??n,endValue:e,byValue:s.byValue??s.by,easing:s.easing,duration:s.duration,abort:s.abort?.bind(this),onChange:(t,e,r)=>{i.reduce(((e,s,r)=>(r===i.length-1&&(e[s]=t),e[s])),this),s.onChange&&s.onChange(t,e,r)},onComplete:(t,e,i)=>{this.setCoords(),s.onComplete&&s.onComplete(t,e,i)}};return r?(t=>{const e=new L(t);return e.start(),e})(o):V(o)}_getAngleValueForStraighten(){const t=this.angle%360;return t>0?90*Math.round((t-1)/90):90*Math.round(t/90)}straighten(){this.rotate(this._getAngleValueForStraighten())}fxStraighten(t={}){const e=t.onComplete||i,s=t.onChange||i;return V({target:this,startValue:this.angle,endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:t=>{this.rotate(t),s(t)},onComplete:()=>{this.setCoords(),e()}})}}new y(1,0);class he{color;blur;offsetX;offsetY;affectStroke;includeDefaultValues;nonScaling;id;constructor(t){const e="string"==typeof t?he.parseShadow(t):t;for(const t in e)this[t]=e[t];this.id=N()}static parseShadow(t){const e=t.trim(),[s,i=0,r=0,n=0]=(he.reOffsetsAndBlur.exec(e)||[]).map((t=>parseFloat(t)||0));return{color:(e.replace(he.reOffsetsAndBlur,"")||"rgb(0,0,0)").trim(),offsetX:i,offsetY:r,blur:n}}toString(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")}toSVG(t){const s=(r=new y(this.offsetX,this.offsetY),n=q(-t.angle),r.rotate(n)),i=new X(this.color);var r,n;let o=40,a=40;return t.width&&t.height&&(o=100*yt((Math.abs(s.x)+this.blur)/t.width,e.NUM_FRACTION_DIGITS)+20,a=100*yt((Math.abs(s.y)+this.blur)/t.height,e.NUM_FRACTION_DIGITS)+20),t.flipX&&(s.x*=-1),t.flipY&&(s.y*=-1),`<filter id="SVGID_${this.id}" y="-${a}%" height="${100+2*a}%" x="-${o}%" width="${100+2*o}%" >\n\t<feGaussianBlur in="SourceAlpha" stdDeviation="${yt(this.blur?this.blur/2:0,e.NUM_FRACTION_DIGITS)}"></feGaussianBlur>\n\t<feOffset dx="${yt(s.x,e.NUM_FRACTION_DIGITS)}" dy="${yt(s.y,e.NUM_FRACTION_DIGITS)}" result="oBlur" ></feOffset>\n\t<feFlood flood-color="${i.toRgb()}" flood-opacity="${i.getAlpha()}"/>\n\t<feComposite in2="oBlur" operator="in" />\n\t<feMerge>\n\t\t<feMergeNode></feMergeNode>\n\t\t<feMergeNode in="SourceGraphic"></feMergeNode>\n\t</feMerge>\n</filter>\n`}toObject(){const t={color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling};if(this.includeDefaultValues)return t;const e=he.prototype,s={};for(const i in t)t[i]!==e[i]&&(s[i]=t[i]);return s}static reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(\d+(?:\.\d*)?(?:px)?)?(?:\s?|$)(?:$|\s)/}Object.assign(he.prototype,{color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,nonScaling:!1}),l.Shadow=he;const ce=(t,e,s)=>{if(s)if(!l.isLikelyNode&&e instanceof Element)t=e;else if(Array.isArray(e)){t=[];for(let i=0,r=e.length;i<r;i++)t[i]=ce({},e[i],s)}else if(e&&"object"==typeof e)for(const i in e)"canvas"===i||"group"===i?t[i]=null:Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=ce({},e[i],s));else t=e;else for(const s in e)t[s]=e[s];return t};let le=class extends ae{type;opacity;cornerSize;touchCornerSize;transparentCorners;hoverCursor;moveCursor;borderColor;borderDashArray;cornerColor;cornerStrokeColor;cornerStyle;cornerDashArray;centeredScaling;centeredRotation;stroke;fill;fillRule;globalCompositeOperation;backgroundColor;selectionBackgroundColor;strokeDashArray;strokeDashOffset;strokeLineCap;strokeLineJoin;strokeMiterLimit;shadow;borderOpacityWhenMoving;borderScaleFactor;minScaleLimit;selectable;evented;visible;hasControls;hasBorders;perPixelTargetFind;includeDefaultValues;lockMovementX;lockMovementY;lockRotation;lockScalingX;lockScalingY;lockSkewingX;lockSkewingY;lockScalingFlip;excludeFromExport;objectCaching;statefullCache;noScaleCache;dirty;paintFirst;activeOn;stateProperties;cacheProperties;clipPath;inverted;absolutePositioned;_cacheContext=null;_cacheCanvas;cacheWidth;cacheHeight;zoomX;zoomY;cacheTranslationX;cacheTranslationY;group;__owningGroup;ownCaching;_transformDone;callSuper;constructor(t){super(),t&&this.setOptions(t)}_createCacheCanvas(){this._cacheCanvas=H(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0}_limitCacheSize(t){const i=t.width,r=t.height,n=e.maxCacheSideLimit,o=e.minCacheSideLimit;if(i<=n&&r<=n&&i*r<=e.perfLimitSizeTotal)return i<o&&(t.width=o),r<o&&(t.height=o),t;const a=i/r,[h,c]=s.limitDimsByArea(a),l=Y(o,h,n),u=Y(o,c,n);return i>l&&(t.zoomX/=i/l,t.width=l,t.capped=!0),r>u&&(t.zoomY/=r/u,t.height=u,t.capped=!0),t}_getCacheCanvasDimensions(){const t=this.getTotalObjectScaling(),e=this._getTransformedDimensions({skewX:0,skewY:0}),s=e.x*t.x/this.scaleX,i=e.y*t.y/this.scaleY;return{width:s+2,height:i+2,zoomX:t.x,zoomY:t.y,x:s,y:i}}_updateCacheCanvas(){const t=this.canvas;if(this.noScaleCache&&t&&t._currentTransform){const e=t._currentTransform.target,s=t._currentTransform.action;if(this===e&&s.slice&&"scale"===s.slice(0,5))return!1}const s=this._cacheCanvas,i=this._cacheContext,r=this._limitCacheSize(this._getCacheCanvasDimensions()),n=e.minCacheSideLimit,o=r.width,a=r.height,h=r.zoomX,c=r.zoomY,u=o!==this.cacheWidth||a!==this.cacheHeight,d=this.zoomX!==h||this.zoomY!==c;if(!s||!i)return!1;let g,f,p=u||d,m=0,v=0,_=!1;if(u){const t=this._cacheCanvas.width,e=this._cacheCanvas.height,s=o>t||a>e;_=s||(o<.9*t||a<.9*e)&&t>n&&e>n,s&&!r.capped&&(o>n||a>n)&&(m=.1*o,v=.1*a)}return this instanceof l.Text&&this.path&&(p=!0,_=!0,m+=this.getHeightOfLine(0)*this.zoomX,v+=this.getHeightOfLine(0)*this.zoomY),!!p&&(_?(s.width=Math.ceil(o+m),s.height=Math.ceil(a+v)):(i.setTransform(1,0,0,1,0,0),i.clearRect(0,0,s.width,s.height)),g=r.x/2,f=r.y/2,this.cacheTranslationX=Math.round(s.width/2-g)+g,this.cacheTranslationY=Math.round(s.height/2-f)+f,this.cacheWidth=o,this.cacheHeight=a,i.translate(this.cacheTranslationX,this.cacheTranslationY),i.scale(h,c),this.zoomX=h,this.zoomY=c,!0)}setOptions(t={}){this._setOptions(t)}transform(t){const e=this.group&&!this.group._transformDone||this.group&&this.canvas&&t===this.canvas.contextTop,s=this.calcTransformMatrix(!e);t.transform(s[0],s[1],s[2],s[3],s[4],s[5])}toObject(t){const s=e.NUM_FRACTION_DIGITS,i=this.clipPath&&!this.clipPath.excludeFromExport?{...this.clipPath.toObject(t),inverted:this.clipPath.inverted,absolutePositioned:this.clipPath.absolutePositioned}:null,r={..._t(this,t),type:this.type,version:c,originX:this.originX,originY:this.originY,left:yt(this.left,s),top:yt(this.top,s),width:yt(this.width,s),height:yt(this.height,s),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:yt(this.strokeWidth,s),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeDashOffset:this.strokeDashOffset,strokeLineJoin:this.strokeLineJoin,strokeUniform:this.strokeUniform,strokeMiterLimit:yt(this.strokeMiterLimit,s),scaleX:yt(this.scaleX,s),scaleY:yt(this.scaleY,s),angle:yt(this.angle,s),flipX:this.flipX,flipY:this.flipY,opacity:yt(this.opacity,s),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,backgroundColor:this.backgroundColor,fillRule:this.fillRule,paintFirst:this.paintFirst,globalCompositeOperation:this.globalCompositeOperation,skewX:yt(this.skewX,s),skewY:yt(this.skewY,s),...i?{clipPath:i}:null};return this.includeDefaultValues?r:this._removeDefaultValues(r)}toDatalessObject(t){return this.toObject(t)}_removeDefaultValues(t){const e=Bt.getClass(t.type).prototype;return Object.keys(t).forEach((function(s){"left"!==s&&"top"!==s&&"type"!==s&&(t[s]===e[s]&&delete t[s],Array.isArray(t[s])&&Array.isArray(e[s])&&0===t[s].length&&0===e[s].length&&delete t[s])})),t}toString(){return`#<${((t,e=!1)=>`${t.charAt(0).toUpperCase()}${e?t.slice(1):t.slice(1).toLowerCase()}`)(this.type)}>`}getObjectScaling(){if(!this.group)return new y(Math.abs(this.scaleX),Math.abs(this.scaleY));const t=tt(this.calcTransformMatrix());return new y(Math.abs(t.scaleX),Math.abs(t.scaleY))}getTotalObjectScaling(){const t=this.getObjectScaling();if(this.canvas){const e=this.canvas.getZoom(),s=this.getCanvasRetinaScaling();return t.scalarMultiply(e*s)}return t}getObjectOpacity(){let t=this.opacity;return this.group&&(t*=this.group.getObjectOpacity()),t}_constrainScale(t){return Math.abs(t)<this.minScaleLimit?t<0?-this.minScaleLimit:this.minScaleLimit:0===t?1e-4:t}_set(t,e){const s=this[t]!==e;if("scaleX"!==t&&"scaleY"!==t||(e=this._constrainScale(e)),"scaleX"===t&&e<0?(this.flipX=!this.flipX,e*=-1):"scaleY"===t&&e<0?(this.flipY=!this.flipY,e*=-1):"shadow"!==t||!e||e instanceof he?"dirty"===t&&this.group&&this.group.set("dirty",e):e=new he(e),this[t]=e,s){const e=this.group&&this.group.isOnACache();this.cacheProperties.indexOf(t)>-1?(this.dirty=!0,e&&this.group.set("dirty",!0)):e&&this.stateProperties.indexOf(t)>-1&&this.group.set("dirty",!0)}return this}isNotVisible(){return 0===this.opacity||!this.width&&!this.height&&0===this.strokeWidth||!this.visible}render(t){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(t.save(),this._setupCompositeOperation(t),this.drawSelectionBackground(t),this.transform(t),this._setOpacity(t),this._setShadow(t),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(t)):(this._removeCacheCanvas(),this.dirty=!1,this.drawObject(t),this.objectCaching&&this.statefullCache&&this.saveState({propertySet:"cacheProperties"})),t.restore())}renderCache(t){t=t||{},this._cacheCanvas&&this._cacheContext||this._createCacheCanvas(),this.isCacheDirty()&&this._cacheContext&&(this.statefullCache&&this.saveState({propertySet:"cacheProperties"}),this.drawObject(this._cacheContext,t.forClipping),this.dirty=!1)}_removeCacheCanvas(){this._cacheCanvas=void 0,this._cacheContext=null,this.cacheWidth=0,this.cacheHeight=0}hasStroke(){return this.stroke&&"transparent"!==this.stroke&&0!==this.strokeWidth}hasFill(){return this.fill&&"transparent"!==this.fill}needsItsOwnCache(){return!("stroke"!==this.paintFirst||!this.hasFill()||!this.hasStroke()||"object"!=typeof this.shadow)||!!this.clipPath}shouldCache(){return this.ownCaching=this.needsItsOwnCache()||this.objectCaching&&(!this.group||!this.group.isOnACache()),this.ownCaching}willDrawShadow(){return!!this.shadow&&(0!==this.shadow.offsetX||0!==this.shadow.offsetY)}drawClipPathOnCache(t,e){if(t.save(),e.inverted?t.globalCompositeOperation="destination-out":t.globalCompositeOperation="destination-in",e.absolutePositioned){const e=Z(this.calcTransformMatrix());t.transform(e[0],e[1],e[2],e[3],e[4],e[5])}e.transform(t),t.scale(1/e.zoomX,1/e.zoomY),t.drawImage(e._cacheCanvas,-e.cacheTranslationX,-e.cacheTranslationY),t.restore()}drawObject(t,e){const s=this.fill,i=this.stroke;e?(this.fill="black",this.stroke="",this._setClippingProperties(t)):this._renderBackground(t),this._render(t),this._drawClipPath(t,this.clipPath),this.fill=s,this.stroke=i}_drawClipPath(t,e){e&&(e._set("canvas",this.canvas),e.shouldCache(),e._transformDone=!0,e.renderCache({forClipping:!0}),this.drawClipPathOnCache(t,e))}drawCacheOnCanvas(t){t.scale(1/this.zoomX,1/this.zoomY),t.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)}isCacheDirty(t=!1){if(this.isNotVisible())return!1;if(this._cacheCanvas&&this._cacheContext&&!t&&this._updateCacheCanvas())return!0;if(this.dirty||this.clipPath&&this.clipPath.absolutePositioned||this.statefullCache&&this.hasStateChanged("cacheProperties")){if(this._cacheCanvas&&this._cacheContext&&!t){const t=this.cacheWidth/this.zoomX,e=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-t/2,-e/2,t,e)}return!0}return!1}_renderBackground(t){if(!this.backgroundColor)return;const e=this._getNonTransformedDimensions();t.fillStyle=this.backgroundColor,t.fillRect(-e.x/2,-e.y/2,e.x,e.y),this._removeShadow(t)}_setOpacity(t){this.group&&!this.group._transformDone?t.globalAlpha=this.getObjectOpacity():t.globalAlpha*=this.opacity}_setStrokeStyles(t,e){const s=e.stroke;s&&(t.lineWidth=e.strokeWidth,t.lineCap=e.strokeLineCap,t.lineDashOffset=e.strokeDashOffset,t.lineJoin=e.strokeLineJoin,t.miterLimit=e.strokeMiterLimit,s.toLive?"percentage"===s.gradientUnits||s.gradientTransform||s.patternTransform?this._applyPatternForTransformedGradient(t,s):(t.strokeStyle=s.toLive(t,this),this._applyPatternGradientTransform(t,s)):t.strokeStyle=e.stroke)}_setFillStyles(t,{fill:e}){e&&(e.toLive?(t.fillStyle=e.toLive(t,this),this._applyPatternGradientTransform(t,e)):t.fillStyle=e)}_setClippingProperties(t){t.globalAlpha=1,t.strokeStyle="transparent",t.fillStyle="#000000"}_setLineDash(t,e){e&&0!==e.length&&(1&e.length&&e.push(...e),t.setLineDash(e))}_setShadow(t){if(!this.shadow)return;const s=this.shadow,i=this.canvas,r=this.getCanvasRetinaScaling(),[n,,,o]=i?.viewportTransform||a,h=n*r,c=o*r,l=s.nonScaling?new y(1,1):this.getObjectScaling();t.shadowColor=s.color,t.shadowBlur=s.blur*e.browserShadowBlurConstant*(h+c)*(l.x+l.y)/4,t.shadowOffsetX=s.offsetX*h*l.x,t.shadowOffsetY=s.offsetY*c*l.y}_removeShadow(t){this.shadow&&(t.shadowColor="",t.shadowBlur=t.shadowOffsetX=t.shadowOffsetY=0)}_applyPatternGradientTransform(t,e){if(!e||!e.toLive)return{offsetX:0,offsetY:0};const s=e.gradientTransform||e.patternTransform,i=-this.width/2+e.offsetX||0,r=-this.height/2+e.offsetY||0;return"percentage"===e.gradientUnits?t.transform(this.width,0,0,this.height,i,r):t.transform(1,0,0,1,i,r),s&&t.transform(s[0],s[1],s[2],s[3],s[4],s[5]),{offsetX:i,offsetY:r}}_renderPaintInOrder(t){"stroke"===this.paintFirst?(this._renderStroke(t),this._renderFill(t)):(this._renderFill(t),this._renderStroke(t))}_render(t){}_renderFill(t){this.fill&&(t.save(),this._setFillStyles(t,this),"evenodd"===this.fillRule?t.fill("evenodd"):t.fill(),t.restore())}_renderStroke(t){if(this.stroke&&0!==this.strokeWidth){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(t),t.save(),this.strokeUniform){const e=this.getObjectScaling();t.scale(1/e.x,1/e.y)}this._setLineDash(t,this.strokeDashArray),this._setStrokeStyles(t,this),t.stroke(),t.restore()}}_applyPatternForTransformedGradient(t,e){const s=this._limitCacheSize(this._getCacheCanvasDimensions()),i=H(),r=this.getCanvasRetinaScaling(),n=s.x/this.scaleX/r,o=s.y/this.scaleY/r;i.width=n,i.height=o;const a=i.getContext("2d");a.beginPath(),a.moveTo(0,0),a.lineTo(n,0),a.lineTo(n,o),a.lineTo(0,o),a.closePath(),a.translate(n/2,o/2),a.scale(s.zoomX/this.scaleX/r,s.zoomY/this.scaleY/r),this._applyPatternGradientTransform(a,e),a.fillStyle=e.toLive(t),a.fill(),t.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2),t.scale(r*this.scaleX/s.zoomX,r*this.scaleY/s.zoomY),t.strokeStyle=a.createPattern(i,"no-repeat")}_findCenterFromElement(){return{x:this.left+this.width/2,y:this.top+this.height/2}}_assignTransformMatrixProps(){if(this.transformMatrix){const t=tt(this.transformMatrix);this.flipX=!1,this.flipY=!1,this.set("scaleX",t.scaleX),this.set("scaleY",t.scaleY),this.angle=t.angle,this.skewX=t.skewX,this.skewY=0}}_removeTransformMatrix(t){let e=this._findCenterFromElement();this.transformMatrix&&(this._assignTransformMatrixProps(),e=J(e,this.transformMatrix)),this.transformMatrix=null,t&&(this.scaleX*=t.scaleX,this.scaleY*=t.scaleY,this.cropX=t.cropX,this.cropY=t.cropY,e.x+=t.offsetLeft,e.y+=t.offsetTop,this.width=t.width,this.height=t.height),this.setPositionByOrigin(e,"center","center")}clone(t){const e=this.toObject(t);return this.constructor.fromObject(e)}cloneAsImage(t){const e=this.toCanvasElement(t);return new l.Image(e)}toCanvasElement(t){t||(t={});const s=Qt(this),i=this.group,r=this.shadow,n=Math.abs,o=t.enableRetinaScaling?Math.max(e.devicePixelRatio,1):1,a=(t.multiplier||1)*o;var h;delete this.group,t.withoutTransform&&((h=this).scaleX=1,h.scaleY=1,h.skewX=0,h.skewY=0,h.flipX=!1,h.flipY=!1,h.rotate(0)),t.withoutShadow&&(this.shadow=null);const c=H(),u=this.getBoundingRect(!0,!0),d=this.shadow,g=new y;if(d){const t=d.blur,e=d.nonScaling?new y(1,1):this.getObjectScaling();g.x=2*Math.round(n(d.offsetX)+t)*n(e.x),g.y=2*Math.round(n(d.offsetY)+t)*n(e.y)}const f=u.width+g.x,p=u.height+g.y;c.width=Math.ceil(f),c.height=Math.ceil(p);let m=new l.StaticCanvas(c,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1});"jpeg"===t.format&&(m.backgroundColor="#fff"),this.setPositionByOrigin(new y(m.width/2,m.height/2),"center","center");const v=this.canvas;m._objects=[this],this.set("canvas",m),this.setCoords();const _=m.toCanvasElement(a||1,t);return this.set("canvas",v),this.shadow=r,i&&(this.group=i),this.set(s),this.setCoords(),m._objects=[],m.destroy(),m=null,_}toDataURL(t={}){return U(this.toCanvasElement(t),t.format||"png",t.quality||1)}isType(...t){return t.includes(this.type)}complexity(){return 1}toJSON(){return this.toObject()}rotate(t){const e=("center"!==this.originX||"center"!==this.originY)&&this.centeredRotation;e&&this._setOriginToCenter(),this.set("angle",t),e&&this._resetOrigin()}centerH(){return this.canvas&&this.canvas.centerObjectH(this),this}viewportCenterH(){return this.canvas&&this.canvas.viewportCenterObjectH(this),this}centerV(){return this.canvas&&this.canvas.centerObjectV(this),this}viewportCenterV(){return this.canvas&&this.canvas.viewportCenterObjectV(this),this}center(){return this.canvas&&this.canvas.centerObject(this),this}viewportCenter(){return this.canvas&&this.canvas.viewportCenterObject(this),this}setOnGroup(){}_setupCompositeOperation(t){this.globalCompositeOperation&&(t.globalCompositeOperation=this.globalCompositeOperation)}dispose(){O&&O.cancelByTarget(this)}static _fromObject(t,{extraParam:e,...s}={}){return $t(((t,e)=>e?ce({},t,e):{...t})(t,!0),s).then((t=>{const{[e]:i,...r}={...s,...t};return e?new this(i,r):new this(r)}))}static fromObject(t,e){return this._fromObject(t,e)}};const ue={type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,touchCornerSize:24,transparentCorners:!0,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgb(178,204,255)",borderDashArray:null,cornerColor:"rgb(178,204,255)",cornerStrokeColor:"",cornerStyle:"rect",cornerDashArray:null,centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,minScaleLimit:0,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,perPixelTargetFind:!1,includeDefaultValues:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,excludeFromExport:!1,objectCaching:!l.isLikelyNode,statefullCache:!1,noScaleCache:!0,strokeUniform:!1,dirty:!0,__corner:0,paintFirst:"fill",activeOn:"down",stateProperties:["top","left","width","height","scaleX","scaleY","flipX","flipY","originX","originY","transformMatrix","stroke","strokeWidth","strokeDashArray","strokeLineCap","strokeDashOffset","strokeLineJoin","strokeMiterLimit","angle","opacity","fill","globalCompositeOperation","shadow","visible","backgroundColor","skewX","skewY","fillRule","paintFirst","clipPath","strokeUniform"],cacheProperties:["fill","stroke","strokeWidth","strokeDashArray","width","height","paintFirst","strokeUniform","strokeLineCap","strokeDashOffset","strokeLineJoin","strokeMiterLimit","backgroundColor","clipPath"],colorProperties:["fill","stroke","backgroundColor"],clipPath:void 0,inverted:!1,absolutePositioned:!1,FX_DURATION:500};Object.assign(le.prototype,ue),Bt.setClass(le);class de extends le{oCoords={};__corner;_controlsVisibility;snapAngle;snapThreshold;controls;isMoving;__isDragging;_scaling;constructor(t){super(t)}_findTargetCorner(t,e=!1){if(!this.hasControls||!this.canvas||this.canvas._activeObject!==this)return 0;this.__corner=0;const s=Object.entries(this.oCoords);for(let i=s.length-1;i>=0;i--){const[r,n]=s[i];if(!this.isControlVisible(r))continue;const o=this._getImageLines(e?n.touchCorner:n.corner),a=this._findCrossPoints(t,o);if(0!==a&&a%2==1)return this.__corner=r,r}return 0}calcOCoords(){const t=this.getViewportTransform(),e=this.getCenterPoint(),s=[1,0,0,1,e.x,e.y],i=et({angle:this.getTotalAngle()-(this.group&&this.flipX?180:0)}),r=Q(s,i),n=Q(t,r),o=Q(n,[1/t[0],0,0,1/t[3],0,0]),a=this.group?tt(this.calcTransformMatrix()):void 0,h=this._calculateCurrentDimensions(a),c={};return this.forEachControl(((t,e,s)=>{c[e]=t.positionHandler(h,o,s)})),c}setCoords(){this.callSuper?ne.prototype.setCoords.call(this):super.setCoords(),this.oCoords=this.calcOCoords(),this._setCornerCoords()}forEachControl(t){for(const e in this.controls)t(this.controls[e],e,this)}_setCornerCoords(){Object.entries(this.oCoords).forEach((([t,e])=>{const s=this.controls[t];e.corner=s.calcCornerCoords(this.angle,this.cornerSize,e.x,e.y,!1),e.touchCorner=s.calcCornerCoords(this.angle,this.touchCornerSize,e.x,e.y,!0)}))}drawSelectionBackground(t){if(!this.selectionBackgroundColor||this.canvas&&!this.canvas.interactive||this.canvas&&this.canvas._activeObject!==this)return;t.save();const e=this.getRelativeCenterPoint(),s=this._calculateCurrentDimensions(),i=this.getViewportTransform();t.translate(e.x,e.y),t.scale(1/i[0],1/i[3]),t.rotate(q(this.angle)),t.fillStyle=this.selectionBackgroundColor,t.fillRect(-s.x/2,-s.y/2,s.x,s.y),t.restore()}strokeBorders(t,e){t.strokeRect(-e.x/2,-e.y/2,e.x,e.y)}_drawBorders(t,e,s={}){const i={hasControls:this.hasControls,borderColor:this.borderColor,borderDashArray:this.borderDashArray,...s};t.save(),t.strokeStyle=i.borderColor,this._setLineDash(t,i.borderDashArray),this.strokeBorders(t,e),i.hasControls&&this.drawControlsConnectingLines(t,e),t.restore()}_renderControls(t,e={}){const{hasBorders:s,hasControls:i}=this,r={hasBorders:s,hasControls:i,...e},n=this.getViewportTransform(),o=r.hasBorders,a=r.hasControls,h=Q(n,this.calcTransformMatrix()),c=tt(h);t.save(),t.translate(c.translateX,c.translateY),t.lineWidth=1*this.borderScaleFactor,this.group||(t.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),this.flipX&&(c.angle-=180),t.rotate(q(this.group?c.angle:this.angle)),o&&this.drawBorders(t,c,e),a&&this.drawControls(t,e),t.restore()}drawBorders(t,e,s){let i;if(s&&s.forActiveSelection||this.group){const t=te(this.width,this.height,e),s=(this.strokeUniform?(new y).scalarAdd(this.canvas?this.canvas.getZoom():1):new y(e.scaleX,e.scaleY)).scalarMultiply(this.strokeWidth);i=t.add(s).scalarAdd(this.borderScaleFactor)}else i=this._calculateCurrentDimensions().scalarAdd(this.borderScaleFactor);this._drawBorders(t,i,s)}drawControlsConnectingLines(t,e){let s=!1;t.beginPath(),this.forEachControl((function(i,r,n){i.withConnection&&i.getVisibility(n,r)&&(s=!0,t.moveTo(i.x*e.x,i.y*e.y),t.lineTo(i.x*e.x+i.offsetX,i.y*e.y+i.offsetY))})),s&&t.stroke()}drawControls(t,e={}){t.save();const s=this.getCanvasRetinaScaling(),{cornerStrokeColor:i,cornerDashArray:r,cornerColor:n}=this,o={cornerStrokeColor:i,cornerDashArray:r,cornerColor:n,...e};t.setTransform(s,0,0,s,0,0),t.strokeStyle=t.fillStyle=o.cornerColor,this.transparentCorners||(t.strokeStyle=o.cornerStrokeColor),this._setLineDash(t,o.cornerDashArray),this.setCoords(),this.forEachControl((function(e,s,i){if(e.getVisibility(i,s)){const r=i.oCoords[s];e.render(t,r.x,r.y,o,i)}})),t.restore()}isControlVisible(t){return this.controls[t]&&this.controls[t].getVisibility(this,t)}setControlVisible(t,e){this._controlsVisibility||(this._controlsVisibility={}),this._controlsVisibility[t]=e}setControlsVisibility(t={}){Object.entries(t).forEach((([t,e])=>this.setControlVisible(t,e)))}clearContextTop(t){if(!this.canvas)return;const e=this.canvas.contextTop;if(!e)return;const s=this.canvas.viewportTransform;e.save(),e.transform(s[0],s[1],s[2],s[3],s[4],s[5]),this.transform(e);const i=this.width+4,r=this.height+4;return e.clearRect(-i/2,-r/2,i,r),t||e.restore(),e}onDeselect(t){return!1}onSelect(t){return!1}canDrop(t){return!1}renderDragSourceEffect(t){}renderDropTargetEffect(t){}}class ge extends de{}var fe,pe;fe=ge,pe=[class{clipPathId;getSvgStyles(t){const e=this.fillRule?this.fillRule:"nonzero",s=this.strokeWidth?this.strokeWidth:"0",i=this.strokeDashArray?this.strokeDashArray.join(" "):"none",r=this.strokeDashOffset?this.strokeDashOffset:"0",n=this.strokeLineCap?this.strokeLineCap:"butt",o=this.strokeLineJoin?this.strokeLineJoin:"miter",a=this.strokeMiterLimit?this.strokeMiterLimit:"4",h=void 0!==this.opacity?this.opacity:"1",c=this.visible?"":" visibility: hidden;",l=t?"":this.getSvgFilter(),u=ee("fill",this.fill);return[ee("stroke",this.stroke),"stroke-width: ",s,"; ","stroke-dasharray: ",i,"; ","stroke-linecap: ",n,"; ","stroke-dashoffset: ",r,"; ","stroke-linejoin: ",o,"; ","stroke-miterlimit: ",a,"; ",u,"fill-rule: ",e,"; ","opacity: ",h,";",l,c].join("")}getSvgSpanStyles(t,e){const s="; ",i=t.fontFamily?`font-family: ${-1===t.fontFamily.indexOf("'")&&-1===t.fontFamily.indexOf('"')?`'${t.fontFamily}'`:t.fontFamily}${s}`:"",r=t.strokeWidth?`stroke-width: ${t.strokeWidth}${s}`:"",n=t.fontSize?`font-size: ${t.fontSize}px${s}`:"",o=t.fontStyle?`font-style: ${t.fontStyle}${s}`:"",a=t.fontWeight?`font-weight: ${t.fontWeight}${s}`:"",h=t.fill?ee("fill",t.fill):"",c=t.stroke?ee("stroke",t.stroke):"",l=this.getSvgTextDecoration(t);return[c,r,i,n,o,a,l?`text-decoration: ${l}${s}`:l,h,t.deltaY?`baseline-shift: ${-t.deltaY}; `:"",e?"white-space: pre; ":""].join("")}getSvgTextDecoration(t){return["overline","underline","line-through"].filter((e=>t[e.replace("-","")])).join(" ")}getSvgFilter(){return this.shadow?`filter: url(#SVGID_${this.shadow.id});`:""}getSvgCommons(){return[this.id?`id="${this.id}" `:"",this.clipPath?`clip-path="url(#${this.clipPath.clipPathId})" `:""].join("")}getSvgTransform(t,e=""){const s=t?this.calcTransformMatrix():this.calcOwnMatrix();return`transform="${Ct(s)}${e}" `}_setSVGBg(t){if(this.backgroundColor){const s=e.NUM_FRACTION_DIGITS;t.push("\t\t<rect ",this._getFillAttributes(this.backgroundColor),' x="',yt(-this.width/2,s),'" y="',yt(-this.height/2,s),'" width="',yt(this.width,s),'" height="',yt(this.height,s),'"></rect>\n')}}toSVG(t){return this._createBaseSVGMarkup(this._toSVG(t),{reviver:t})}toClipPathSVG(t){return"\t"+this._createBaseClipPathSVGMarkup(this._toSVG(t),{reviver:t})}_createBaseClipPathSVGMarkup(t,{reviver:e,additionalTransform:s=""}={}){const i=[this.getSvgTransform(!0,s),this.getSvgCommons()].join(""),r=t.indexOf("COMMON_PARTS");return t[r]=i,e?e(t.join("")):t.join("")}_createBaseSVGMarkup(t,{noStyle:e,reviver:s,withShadow:i,additionalTransform:r}={}){const n=e?"":`style="${this.getSvgStyles()}" `,o=i?`style="${this.getSvgFilter()}" `:"",a=this.clipPath,h=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",c=a&&a.absolutePositioned,l=this.stroke,u=this.fill,d=this.shadow,g=[],f=t.indexOf("COMMON_PARTS");let p;a&&(a.clipPathId=`CLIPPATH_${N()}`,p=`<clipPath id="${a.clipPathId}" >\n${a.toClipPathSVG(s)}</clipPath>\n`),c&&g.push("<g ",o,this.getSvgCommons()," >\n"),g.push("<g ",this.getSvgTransform(!1),c?"":o+this.getSvgCommons()," >\n");const m=[n,h,e?"":this.addPaintOrder()," ",r?`transform="${r}" `:""].join("");return t[f]=m,u&&u.toLive&&g.push(u.toSVG(this)),l&&l.toLive&&g.push(l.toSVG(this)),d&&g.push(d.toSVG(this)),a&&g.push(p),g.push(t.join("")),g.push("</g>\n"),c&&g.push("</g>\n"),s?s(g.join("")):g.join("")}addPaintOrder(){return"fill"!==this.paintFirst?` paint-order="${this.paintFirst}" `:""}}],pe.forEach((t=>{Object.getOwnPropertyNames(t.prototype).forEach((e=>{"constructor"!==e&&Object.defineProperty(fe.prototype,e,Object.getOwnPropertyDescriptor(t.prototype,e)||Object.create(null))}))})),l.Object=ge;const me=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path"];function ve(t,e){let s,i,r=t.nodeName,n=t.getAttribute("class"),o=t.getAttribute("id");if(s=new RegExp("^"+r,"i"),e=e.replace(s,""),o&&e.length&&(s=new RegExp("#"+o+"(?![a-zA-Z\\-]+)","i"),e=e.replace(s,"")),n&&e.length)for(n=n.split(" "),i=n.length;i--;)s=new RegExp("\\."+n[i]+"(?![a-zA-Z\\-]+)","i"),e=e.replace(s,"");return 0===e.length}function _e(t,e){let s,i=!0;return s=ve(t,e.pop()),s&&e.length&&(i=function(t,e){let s,i=!0;for(;t.parentNode&&1===t.parentNode.nodeType&&e.length;)i&&(s=e.pop()),i=ve(t=t.parentNode,s);return 0===e.length}(t,e)),s&&i&&0===e.length}function ye(t){return t in ht?ht[t]:t}function be(t,e,s,i){let r,n=Array.isArray(e);if("fill"!==t&&"stroke"!==t||"none"!==e){if("strokeUniform"===t)return"non-scaling-stroke"===e;if("strokeDashArray"===t)e="none"===e?null:e.replace(/,/g," ").split(/\s+/).map(parseFloat);else if("transformMatrix"===t)e=s&&s.transformMatrix?Q(s.transformMatrix,vt(e)):vt(e);else if("visible"===t)e="none"!==e&&"hidden"!==e,s&&!1===s.visible&&(e=!1);else if("opacity"===t)e=parseFloat(e),s&&void 0!==s.opacity&&(e*=s.opacity);else if("textAnchor"===t)e="start"===e?"left":"end"===e?"right":"center";else if("charSpacing"===t)r=bt(e,i)/i*1e3;else if("paintFirst"===t){const t=e.indexOf("fill"),s=e.indexOf("stroke");e="fill";(t>-1&&s>-1&&s<t||-1===t&&s>-1)&&(e="stroke")}else{if("href"===t||"xlink:href"===t||"font"===t)return e;if("imageSmoothing"===t)return"optimizeQuality"===e;r=n?e.map(bt):bt(e,i)}}else e="";return!n&&isNaN(r)?e:r}function Ce(t,e,s){if(!t)return{};let i,r,n,o={};void 0===s&&(s=t.getAttribute("svgUid")),t.parentNode&&dt.test(t.parentNode.nodeName)&&(o=Ce(t.parentNode,e,s));let a=e.reduce((function(e,s){return i=t.getAttribute(s),i&&(e[s]=i),e}),{});const h=Object.assign(function(t,e){const s={};for(const i in rt[e])if(_e(t,i.split(" ")))for(const t in rt[e][i])s[t]=rt[e][i][t];return s}(t,s),function(t){const e={},s=t.getAttribute("style");return s?("string"==typeof s?function(t,e){let s,i;t.replace(/;\s*$/,"").split(";").forEach((function(t){const r=t.split(":");s=r[0].trim().toLowerCase(),i=r[1].trim(),e[s]=i}))}(s,e):function(t,e){let s,i;for(const r in t)void 0!==t[r]&&(s=r.toLowerCase(),i=t[r],e[s]=i)}(s,e),e):e}(t));a=Object.assign(a,h),h[ut]&&t.setAttribute(ut,h[ut]),r=n=o.fontSize||16,a[lt]&&(a[lt]=r=bt(a[lt],n));const c={};for(const t in a){const e=ye(t),s=be(e,a[t],o,r);c[e]=s}c&&c.font&&function(t,e){const s=t.match(at);if(!s)return;const i=s[1],r=s[3],n=s[4],o=s[5],a=s[6];i&&(e.fontStyle=i),r&&(e.fontWeight=isNaN(parseFloat(r))?r:parseFloat(r)),n&&(e.fontSize=bt(n)),a&&(e.fontFamily=a),o&&(e.lineHeight="normal"===o?1:o)}(c.font,c);const l={...o,...c};return dt.test(t.nodeName)?l:function(t){for(const e in ct){if(void 0===t[ct[e]]||""===t[e])continue;if(void 0===t[e]){if(!ge.prototype[e])continue;t[e]=ge.prototype[e]}if(0===t[e].indexOf("url("))continue;const s=new X(t[e]);t[e]=s.setAlpha(yt(s.getAlpha()*t[ct[e]],2)).toRgba()}return t}(l)}class we extends ge{rx;ry;constructor(t){super(t),this._initRxRy()}_initRxRy(){const{rx:t,ry:e}=this;t&&!e?this.ry=t:e&&!t&&(this.rx=e)}_render(t){const{width:e,height:s}=this,i=-e/2,r=-s/2,n=this.rx?Math.min(this.rx,e/2):0,o=this.ry?Math.min(this.ry,s/2):0,a=0!==n||0!==o;t.beginPath(),t.moveTo(i+n,r),t.lineTo(i+e-n,r),a&&t.bezierCurveTo(i+e-h*n,r,i+e,r+h*o,i+e,r+o),t.lineTo(i+e,r+s-o),a&&t.bezierCurveTo(i+e,r+s-h*o,i+e-h*n,r+s,i+e-n,r+s),t.lineTo(i+n,r+s),a&&t.bezierCurveTo(i+h*n,r+s,i,r+s-h*o,i,r+s-o),t.lineTo(i,r+o),a&&t.bezierCurveTo(i,r+h*o,i+h*n,r,i+n,r),t.closePath(),this._renderPaintInOrder(t)}toObject(t=[]){return super.toObject(["rx","ry",...t])}_toSVG(){const{width:t,height:e,rx:s,ry:i}=this;return["<rect ","COMMON_PARTS",`x="${-t/2}" y="${-e/2}" rx="${s}" ry="${i}" width="${t}" height="${e}" />\n`]}static ATTRIBUTE_NAMES=[...me,"x","y","rx","ry","width","height"];static fromElement(t,e,s={}){if(!t)return e(null);const{left:i=0,top:r=0,width:n=0,height:o=0,visible:a=!0,...h}=Ce(t,this.ATTRIBUTE_NAMES);e(new this({...s,...h,left:i,top:r,width:n,height:o,visible:Boolean(a&&n&&o)}))}}const xe={stateProperties:ue.stateProperties.concat("rx","ry"),type:"rect",rx:0,ry:0,cacheProperties:ue.cacheProperties.concat("rx","ry")};Object.assign(we.prototype,xe),Bt.setClass(we),Bt.setSVGClass(we),l.Rect=we;class Oe extends(f(ge)){layout;subTargetCheck;interactive;_activeObjects=[];constructor(t=[],e={},s){super(),this._objects=t||[],this.__objectMonitor=this.__objectMonitor.bind(this),this.__objectSelectionTracker=this.__objectSelectionMonitor.bind(this,!0),this.__objectSelectionDisposer=this.__objectSelectionMonitor.bind(this,!1),this._firstLayoutDone=!1,this.set({...e,angle:0,skewX:0,skewY:0}),this.forEachObject((t=>{this.enterGroup(t,!1)})),this._applyLayoutStrategy({type:"initialization",options:e,objectsRelativeToGroup:s})}canEnterGroup(t){return t===this||this.isDescendantOf(t)?(console.error("fabric.Group: circular object trees are not supported, this call has no effect"),!1):-1===this._objects.indexOf(t)||(console.error("fabric.Group: duplicate objects are not supported inside group, this call has no effect"),!1)}_filterObjectsBeforeEnteringGroup(t){return t.filter(((t,e,s)=>this.canEnterGroup(t)&&s.indexOf(t)===e))}add(...t){const e=this._filterObjectsBeforeEnteringGroup(t),s=super.add(...e);return this._onAfterObjectsChange("added",e),s}insertAt(t,...e){const s=this._filterObjectsBeforeEnteringGroup(e),i=super.insertAt(t,...s);return this._onAfterObjectsChange("added",s),i}remove(...t){const e=super.remove(...t);return this._onAfterObjectsChange("removed",e),e}_onObjectAdded(t){this.enterGroup(t,!0),this.fire("object:added",{target:t}),t.fire("added",{target:this})}_onRelativeObjectAdded(t){this.enterGroup(t,!1),this.fire("object:added",{target:t}),t.fire("added",{target:this})}_onObjectRemoved(t,e){this.exitGroup(t,e),this.fire("object:removed",{target:t}),t.fire("removed",{target:this})}_onAfterObjectsChange(t,e){this._applyLayoutStrategy({type:t,targets:e}),this._set("dirty",!0)}_onStackOrderChanged(){this._set("dirty",!0)}_set(t,e){const s=this[t];return super._set(t,e),"canvas"===t&&s!==e&&this.forEachObject((s=>{s._set(t,e)})),"layout"===t&&s!==e&&this._applyLayoutStrategy({type:"layout_change",layout:e,prevLayout:s}),"interactive"===t&&this.forEachObject((t=>this._watchObject(e,t))),this}_shouldSetNestedCoords(){return this.subTargetCheck}removeAll(){return this._activeObjects=[],this.remove(...this._objects)}__objectMonitor(t){this._applyLayoutStrategy({...t,type:"object_modified"}),this._set("dirty",!0)}__objectSelectionMonitor(t,e){const s=e.target;if(t)this._activeObjects.push(s),this._set("dirty",!0);else if(this._activeObjects.length>0){const t=this._activeObjects.indexOf(s);t>-1&&(this._activeObjects.splice(t,1),this._set("dirty",!0))}}_watchObject(t,e){const s=t?"on":"off";t&&this._watchObject(!1,e),e[s]("changed",this.__objectMonitor),e[s]("modified",this.__objectMonitor),e[s]("selected",this.__objectSelectionTracker),e[s]("deselected",this.__objectSelectionDisposer)}enterGroup(t,e){return t.group&&t.group.remove(t),this._enterGroup(t,e),!0}_enterGroup(t,e){e&&Zt(t,Q(Z(this.calcTransformMatrix()),t.calcTransformMatrix())),this._shouldSetNestedCoords()&&t.setCoords(),t._set("group",this),t._set("canvas",this.canvas),this.interactive&&this._watchObject(!0,t);const s=this.canvas&&this.canvas.getActiveObject&&this.canvas.getActiveObject();s&&(s===t||t.isDescendantOf(s))&&this._activeObjects.push(t)}exitGroup(t,e){this._exitGroup(t,e),t._set("canvas",void 0)}_exitGroup(t,e){t._set("group",void 0),e||(Zt(t,Q(this.calcTransformMatrix(),t.calcTransformMatrix())),t.setCoords()),this._watchObject(!1,t);const s=this._activeObjects.length>0?this._activeObjects.indexOf(t):-1;s>-1&&this._activeObjects.splice(s,1)}shouldCache(){const t=ge.prototype.shouldCache.call(this);if(t)for(let t=0;t<this._objects.length;t++)if(this._objects[t].willDrawShadow())return this.ownCaching=!1,!1;return t}willDrawShadow(){if(ge.prototype.willDrawShadow.call(this))return!0;for(let t=0;t<this._objects.length;t++)if(this._objects[t].willDrawShadow())return!0;return!1}isOnACache(){return this.ownCaching||!!this.group&&this.group.isOnACache()}drawObject(t){this._renderBackground(t);for(let e=0;e<this._objects.length;e++)this._objects[e].render(t);this._drawClipPath(t,this.clipPath)}isCacheDirty(t){if(super.isCacheDirty(t))return!0;if(!this.statefullCache)return!1;for(let t=0;t<this._objects.length;t++)if(this._objects[t].isCacheDirty(!0)){if(this._cacheCanvas){const t=this.cacheWidth/this.zoomX,e=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-t/2,-e/2,t,e)}return!0}return!1}setCoords(){super.setCoords(),this._shouldSetNestedCoords()&&this.forEachObject((t=>t.setCoords()))}render(t){this._transformDone=!0,super.render(t),this._transformDone=!1}triggerLayout(t){t&&t.layout&&(t.prevLayout=this.layout,this.layout=t.layout),this._applyLayoutStrategy({type:"imperative",context:t})}_adjustObjectPosition(t,e){t.set({left:t.left+e.x,top:t.top+e.y})}_applyLayoutStrategy(t){const e="initialization"===t.type;if(!e&&!this._firstLayoutDone)return;const s=e&&t.options,i=s&&{angle:s.angle||0,skewX:s.skewX||0,skewY:s.skewY||0},r=this.getRelativeCenterPoint();let n,o=this.getLayoutStrategyResult(this.layout,this._objects.concat(),t);if(o){const s=new y(o.centerX,o.centerY),a=r.subtract(s).add(new y(o.correctionX||0,o.correctionY||0));n=a.transform(Z(this.calcOwnMatrix()),!0),this.set({width:o.width,height:o.height}),!t.objectsRelativeToGroup&&this.forEachObject((t=>{this._adjustObjectPosition(t,n)})),!e&&"clip-path"!==this.layout&&this.clipPath&&!this.clipPath.absolutePositioned&&this._adjustObjectPosition(this.clipPath,n),s.eq(r)&&!i||(this.setPositionByOrigin(s,"center","center"),i&&this.set(i),this.setCoords())}else{if(!e)return;o={centerX:r.x,centerY:r.y,width:this.width,height:this.height},i&&this.set(i)}this._firstLayoutDone=!0,this.onLayout(t,o),this.fire("layout",{context:t,result:o,diff:n}),this.group&&this.group._applyLayoutStrategy&&(t.path||(t.path=[]),t.path.push(this),this.group._applyLayoutStrategy(t))}getLayoutStrategyResult(t,e,s){if("fit-content-lazy"===t&&"added"===s.type&&e.length>s.targets.length){const e=s.targets.concat(this);return this.prepareBoundingBox(t,e,s)}if("fit-content"===t||"fit-content-lazy"===t||"fixed"===t&&("initialization"===s.type||"imperative"===s.type))return this.prepareBoundingBox(t,e,s);if("clip-path"===t&&this.clipPath){const i=this.clipPath,r=i._getTransformedDimensions();if(i.absolutePositioned&&("initialization"===s.type||"layout_change"===s.type)){const t=i.getCenterPoint();if(this.group){const e=Z(this.group.calcTransformMatrix());t=J(t,e)}return{centerX:t.x,centerY:t.y,width:r.x,height:r.y}}if(!i.absolutePositioned){let n;const o=i.getRelativeCenterPoint(),a=J(o,this.calcOwnMatrix(),!0);if("initialization"===s.type||"layout_change"===s.type){const r=this.prepareBoundingBox(t,e,s)||{};return n=new y(r.centerX||0,r.centerY||0),{centerX:n.x+a.x,centerY:n.y+a.y,correctionX:r.correctionX-a.x,correctionY:r.correctionY-a.y,width:i.width,height:i.height}}return n=this.getRelativeCenterPoint(),{centerX:n.x+a.x,centerY:n.y+a.y,width:r.x,height:r.y}}}else if("svg"===t&&"initialization"===s.type){const t=this.getObjectsBoundingBox(e,!0)||{};return Object.assign(t,{correctionX:-t.offsetX||0,correctionY:-t.offsetY||0})}}prepareBoundingBox(t,e,s){return"initialization"===s.type?this.prepareInitialBoundingBox(t,e,s):"imperative"===s.type&&s.context?Object.assign(this.getObjectsBoundingBox(e)||{},s.context):this.getObjectsBoundingBox(e)}prepareInitialBoundingBox(t,e,s){const i=s.options||{},r="number"==typeof i.left,n="number"==typeof i.top,o="number"==typeof i.width,a="number"==typeof i.height;if(r&&n&&o&&a&&s.objectsRelativeToGroup||0===e.length)return;const h=this.getObjectsBoundingBox(e)||{},c=o?this.width:h.width||0,l=a?this.height:h.height||0,u=new y(h.centerX||0,h.centerY||0),d=new y(Kt(this.originX),Kt(this.originY)),g=new y(c,l),f=this._getTransformedDimensions({width:0,height:0}),p=this._getTransformedDimensions({width:c,height:l,strokeWidth:0}),m=this._getTransformedDimensions({width:h.width,height:h.height,strokeWidth:0}),v=new y(0,0),_=d.scalarAdd(.5),b=p.multiply(_),C=new y(o?m.x/2:b.x,a?m.y/2:b.y),w=new y(r?this.left-(p.x+f.x)*d.x:u.x-C.x,n?this.top-(p.y+f.y)*d.y:u.y-C.y),x=new y(r?w.x-u.x+m.x*(o?.5:0):-(o?.5*(p.x-f.x):p.x*_.x),n?w.y-u.y+m.y*(a?.5:0):-(a?.5*(p.y-f.y):p.y*_.y)).add(v),O=new y(o?-p.x/2:0,a?-p.y/2:0).add(x);return{centerX:w.x,centerY:w.y,correctionX:O.x,correctionY:O.y,width:g.x,height:g.y}}getObjectsBoundingBox(t,e){if(0===t.length)return null;let s,i;t.forEach(((t,e)=>{const r=t.getRelativeCenterPoint();let n=t._getTransformedDimensions().scalarDivide(2);if(t.angle){const e=q(t.angle),s=Math.abs(_(e)),i=Math.abs(v(e)),r=n.x*i+n.y*s,o=n.x*s+n.y*i;n=new y(r,o)}const o=r.subtract(n),a=r.add(n);0===e?(s=new y(Math.min(o.x,a.x),Math.min(o.y,a.y)),i=new y(Math.max(o.x,a.x),Math.max(o.y,a.y))):(s.setXY(Math.min(s.x,o.x,a.x),Math.min(s.y,o.y,a.y)),i.setXY(Math.max(i.x,o.x,a.x),Math.max(i.y,o.y,a.y)))}));const r=i.subtract(s),n=e?r.scalarDivide(2):s.midPointFrom(i),o=s.transform(this.calcOwnMatrix()),a=n.transform(this.calcOwnMatrix());return{offsetX:o.x,offsetY:o.y,centerX:a.x,centerY:a.y,width:r.x,height:r.y}}onLayout(t,e){}__serializeObjects(t,e){const s=this.includeDefaultValues;return this._objects.filter((function(t){return!t.excludeFromExport})).map((function(i){const r=i.includeDefaultValues;i.includeDefaultValues=s;const n=i[t||"toObject"](e);return i.includeDefaultValues=r,n}))}toObject(t=[]){const e=super.toObject(["layout","subTargetCheck","interactive",...t]);return e.objects=this.__serializeObjects("toObject",t),e}toString(){return`#<Group: (${this.complexity()})>`}dispose(){this._activeObjects=[],this.forEachObject((t=>{this._watchObject(!1,t),t.dispose()})),super.dispose()}_createSVGBgRect(t){if(!this.backgroundColor)return"";const e=we.prototype._toSVG.call(this,t),s=e.indexOf("COMMON_PARTS");return e[s]='for="group" ',e.join("")}_toSVG(t){const e=["<g ","COMMON_PARTS"," >\n"],s=this._createSVGBgRect(t);s&&e.push("\t\t",s);for(let s=0;s<this._objects.length;s++)e.push("\t\t",this._objects[s].toSVG(t));return e.push("</g>\n"),e}getSvgStyles(){const t=void 0!==this.opacity&&1!==this.opacity?`opacity: ${this.opacity};`:"",e=this.visible?"":" visibility: hidden;";return[t,this.getSvgFilter(),e].join("")}toClipPathSVG(t){const e=[],s=this._createSVGBgRect(t);s&&e.push("\t",s);for(let s=0;s<this._objects.length;s++)e.push("\t",this._objects[s].toClipPathSVG(t));return this._createBaseClipPathSVGMarkup(e,{reviver:t})}static fromObject({objects:t=[],...e}){return Promise.all([It(t),$t(e)]).then((([t,s])=>new this(t,{...e,...s},!0)))}}const Se={type:"group",layout:"fit-content",strokeWidth:0,stateProperties:ue.stateProperties.concat("layout"),subTargetCheck:!1,interactive:!1};Object.assign(Oe.prototype,Se),Bt.setClass(Oe),l.Group=Oe;class ke extends Oe{constructor(t,e,s){super(t,e,s),this.setCoords()}_shouldSetNestedCoords(){return!0}enterGroup(t,e){if(t.group){const e=t.group;e._exitGroup(t),t.__owningGroup=e}return this._enterGroup(t,e),!0}exitGroup(t,e){this._exitGroup(t,e);const s=t.__owningGroup;s&&(s.enterGroup(t),delete t.__owningGroup)}_onAfterObjectsChange(t,e){super._onAfterObjectsChange(t,e);const s=[];e.forEach((t=>{t.group&&!s.includes(t.group)&&s.push(t.group)})),"removed"===t?s.forEach((t=>{t._onAfterObjectsChange("added",e)})):s.forEach((t=>{t._set("dirty",!0)}))}onDeselect(){return this.removeAll(),!1}toString(){return`#<ActiveSelection: (${this.complexity()})>`}shouldCache(){return!1}isOnACache(){return!1}_renderControls(t,e,s){t.save(),t.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,super._renderControls(t,e);const i={hasControls:!1,...s,forActiveSelection:!0};for(let e=0;e<this._objects.length;e++)this._objects[e]._renderControls(t,i);t.restore()}}const Te={...Se,type:"activeSelection",layout:"fit-content",subTargetCheck:!1,interactive:!1};Object.assign(ke.prototype,Te),Bt.setClass(ke),l.ActiveSelection=ke;const je=["touchstart","touchmove","touchend"];const Ee=t=>{t.preventDefault(),t.stopPropagation()},De=(t,e=a,s=a)=>t.transform(((t=a,e=a)=>Q(Z(e),t))(e,s)),Ae="not-allowed";function Me(t){return"center"===t.originX&&"center"===t.originY}function Fe(t){return.5-Kt(t)}const Pe=(t,e)=>t[e],Re=(t,e,s,i)=>({e:t,transform:e,pointer:new y(s,i)});function Xe(t,e){const s=t.getTotalAngle()+K(Math.atan2(e.y,e.x))+360;return Math.round(s%360/45)}function Ye({target:t,corner:e},s,i,r,n){const o=t.controls[e],a=t.canvas?.getZoom()||1,h=t.padding/a,c=function(t,e,s,i){const r=t.getRelativeCenterPoint(),n=void 0!==s&&void 0!==i?t.translateToGivenOrigin(r,"center","center",s,i):new y(t.left,t.top);return(t.angle?e.rotate(-q(t.angle),r):e).subtract(n)}(t,new y(r,n),s,i);return c.x>=h&&(c.x-=h),c.x<=-h&&(c.x+=h),c.y>=h&&(c.y-=h),c.y<=h&&(c.y+=h),c.x-=o.offsetX,c.y-=o.offsetY,c}const Be=(t,e)=>{const{transform:{target:s}}=e;s.canvas?.fire(`object:${t}`,{...e,target:s}),s.fire(t,e)},Le=(t,e)=>(s,i,r,n)=>{const o=e(s,i,r,n);return o&&Be(t,Re(s,i,r,n)),o};function Ve(t){return(e,s,i,r)=>{const{target:n,originX:o,originY:a}=s,h=n.getRelativeCenterPoint(),c=n.translateToOriginPoint(h,o,a),l=t(e,s,i,r);return n.setPositionByOrigin(c,o,a),l}}const Ie=Le("resizing",Ve(((t,e,s,i)=>{const r=Ye(e,e.originX,e.originY,s,i);if("center"===e.originX||"right"===e.originX&&r.x<0||"left"===e.originX&&r.x>0){const{target:t}=e,s=t.strokeWidth/(t.strokeUniform?t.scaleX:1),i=Me(e)?2:1,n=t.width,o=Math.ceil(Math.abs(r.x*i/t.scaleX)-s);return t.set("width",Math.max(o,0)),n!==t.width}return!1})));const $e=(t,e,s,i)=>{const{target:r,offsetX:n,offsetY:o}=e,a=s-n,h=i-o,c=!Pe(r,"lockMovementX")&&r.left!==a,l=!Pe(r,"lockMovementY")&&r.top!==h;return c&&r.set("left",a),l&&r.set("top",h),(c||l)&&Be("moving",Re(t,e,s,i)),c||l},Ge=Le("rotating",Ve(((t,{target:e,ex:s,ey:i,theta:r,originX:n,originY:o},a,h)=>{const c=e.translateToOriginPoint(e.getRelativeCenterPoint(),n,o);if(Pe(e,"lockRotation"))return!1;const l=Math.atan2(i-c.y,s-c.x),u=Math.atan2(h-c.y,a-c.x);let d=K(u-l+r);if(e.snapAngle&&e.snapAngle>0){const t=e.snapAngle,s=e.snapThreshold||t,i=Math.ceil(d/t)*t,r=Math.floor(d/t)*t;Math.abs(d-r)<s?d=r:Math.abs(d-i)<s&&(d=i)}d<0&&(d=360+d),d%=360;const g=e.angle!==d;return e.angle=d,g})));function ze(t,e){const s=e.canvas,i=t[s.uniScaleKey];return s.uniformScaling&&!i||!s.uniformScaling&&i}function We(t,e,s){const i=Pe(t,"lockScalingX"),r=Pe(t,"lockScalingY");return!(!i||!r)||(!(e||!i&&!r||!s)||(!(!i||"x"!==e)||!(!r||"y"!==e)))}const Ne=["e","se","s","sw","w","nw","n","ne","e"],He=(t,e,s)=>{const i=ze(t,s);if(We(s,0!==e.x&&0===e.y?"x":0===e.x&&0!==e.y?"y":"",i))return Ae;const r=Xe(s,e);return`${Ne[r]}-resize`};function Ue(t,e,s,i,r={}){const n=e.target,o=r.by,a=ze(t,n);let h,c,l,u,d,g;if(We(n,o,a))return!1;if(e.gestureScale)c=e.scaleX*e.gestureScale,l=e.scaleY*e.gestureScale;else{if(h=Ye(e,e.originX,e.originY,s,i),d="y"!==o?Math.sign(h.x||e.signX||1):1,g="x"!==o?Math.sign(h.y||e.signY||1):1,e.signX||(e.signX=d),e.signY||(e.signY=g),Pe(n,"lockScalingFlip")&&(e.signX!==d||e.signY!==g))return!1;if(u=n._getTransformedDimensions(),a&&!o){const t=Math.abs(h.x)+Math.abs(h.y),{original:s}=e,i=t/(Math.abs(u.x*s.scaleX/n.scaleX)+Math.abs(u.y*s.scaleY/n.scaleY));c=s.scaleX*i,l=s.scaleY*i}else c=Math.abs(h.x*n.scaleX/u.x),l=Math.abs(h.y*n.scaleY/u.y);Me(e)&&(c*=2,l*=2),e.signX!==d&&"y"!==o&&(e.originX=Fe(e.originX),c*=-1,e.signX=d),e.signY!==g&&"x"!==o&&(e.originY=Fe(e.originY),l*=-1,e.signY=g)}const f=n.scaleX,p=n.scaleY;return o?("x"===o&&n.set("scaleX",c),"y"===o&&n.set("scaleY",l)):(!Pe(n,"lockScalingX")&&n.set("scaleX",c),!Pe(n,"lockScalingY")&&n.set("scaleY",l)),f!==n.scaleX||p!==n.scaleY}const qe=Le("scaling",Ve(((t,e,s,i)=>Ue(t,e,s,i)))),Ke=Le("scaling",Ve(((t,e,s,i)=>Ue(t,e,s,i,{by:"x"})))),Je=Le("scaling",Ve(((t,e,s,i)=>Ue(t,e,s,i,{by:"y"})))),Ze={x:{counterAxis:"y",scale:"scaleX",skew:"skewX",lockSkewing:"lockSkewingX",origin:"originX",flip:"flipX"},y:{counterAxis:"x",scale:"scaleY",skew:"skewY",lockSkewing:"lockSkewingY",origin:"originY",flip:"flipY"}},Qe=["ns","nesw","ew","nwse"],ts=(t,e,s)=>{if(0!==e.x&&Pe(s,"lockSkewingY"))return Ae;if(0!==e.y&&Pe(s,"lockSkewingX"))return Ae;const i=Xe(s,e)%4;return`${Qe[i]}-resize`};function es(t,e,s,i,r){const{target:n}=s,{counterAxis:o,origin:a,lockSkewing:h,skew:c,flip:l}=Ze[t];if(Pe(n,h))return!1;const{origin:u,flip:d}=Ze[o],g=Kt(s[u])*(n[d]?-1:1),f=-Math.sign(g)*(n[l]?-1:1),p=.5*-((0===n[c]&&Ye(s,"center","center",i,r)[t]>0||n[c]>0?1:-1)*f)+.5,m=Le("skewing",Ve(((e,s,i,r)=>function(t,{target:e,ex:s,ey:i,skewingSide:r,...n},o){const{skew:a}=Ze[t],h=o.subtract(new y(s,i)).divide(new y(e.scaleX,e.scaleY))[t],c=e[a],l=n[a],u=Math.tan(q(l)),d="y"===t?e._getTransformedDimensions({scaleX:1,scaleY:1,skewX:0}).x:e._getTransformedDimensions({scaleX:1,scaleY:1}).y,g=2*h*r/Math.max(d,1)+u,f=K(Math.atan(g));e.set(a,f);const p=c!==e[a];if(p&&"y"===t){const{skewX:t,scaleX:s}=e,i=e._getTransformedDimensions({skewY:c}),r=e._getTransformedDimensions(),n=0!==t?i.x/r.x:1;1!==n&&e.set("scaleX",n*s)}return p}(t,s,new y(i,r)))));return m(e,{...s,[a]:p,skewingSide:f},i,r)}const ss=(t,e,s,i)=>es("x",t,e,s,i),is=(t,e,s,i)=>es("y",t,e,s,i);function rs(t,e){return t[e.canvas.altActionKey]}l.controlsUtils={scaleCursorStyleHandler:He,skewCursorStyleHandler:ts,scaleSkewCursorStyleHandler:(t,e,s)=>rs(t,s)?ts(0,e,s):He(t,e,s),rotationWithSnapping:Ge,scalingEqually:qe,scalingX:Ke,scalingY:Je,scalingYOrSkewingX:(t,e,s,i)=>rs(t,e.target)?ss(t,e,s,i):Je(t,e,s,i),scalingXOrSkewingY:(t,e,s,i)=>rs(t,e.target)?is(t,e,s,i):Ke(t,e,s,i),changeWidth:Ie,skewHandlerX:ss,skewHandlerY:is,dragHandler:$e,scaleOrSkewActionName:(t,e,s)=>{const i=rs(t,s);return 0===e.x?i?"skewX":"scaleY":0===e.y?i?"skewY":"scaleX":void 0},rotationStyleHandler:(t,e,s)=>s.lockRotation?Ae:e.cursorStyle,wrapWithFixedAnchor:Ve,wrapWithFireEvent:Le,getLocalPoint:Ye,renderCircleControl:function(t,e,s,i,r){i=i||{};const o=this.sizeX||i.cornerSize||r.cornerSize,a=this.sizeY||i.cornerSize||r.cornerSize,h=void 0!==i.transparentCorners?i.transparentCorners:r.transparentCorners,c=h?"stroke":"fill",l=!h&&(i.cornerStrokeColor||r.cornerStrokeColor);let u,d=e,g=s;t.save(),t.fillStyle=i.cornerColor||r.cornerColor||"",t.strokeStyle=i.cornerStrokeColor||r.cornerStrokeColor||"",o>a?(u=o,t.scale(1,a/o),g=s*o/a):a>o?(u=a,t.scale(o/a,1),d=e*a/o):u=o,t.lineWidth=1,t.beginPath(),t.arc(d,g,u/2,0,n,!1),t[c](),l&&t.stroke(),t.restore()},renderSquareControl:function(t,e,s,i,r){i=i||{};const n=this.sizeX||i.cornerSize||r.cornerSize,o=this.sizeY||i.cornerSize||r.cornerSize,a=void 0!==i.transparentCorners?i.transparentCorners:r.transparentCorners,h=a?"stroke":"fill",c=!a&&(i.cornerStrokeColor||r.cornerStrokeColor),l=n/2,u=o/2;t.save(),t.fillStyle=i.cornerColor||r.cornerColor||"",t.strokeStyle=i.cornerStrokeColor||r.cornerStrokeColor||"",t.lineWidth=1,t.translate(e,s);const d=r.getTotalAngle();t.rotate(q(d)),t[`${h}Rect`](-l,-u,n,o),c&&t.strokeRect(-l,-u,n,o),t.restore()}};const ns=(t,e,s,i)=>{i>0&&(e>i?e-=i:e=0,s>i?s-=i:s=0);let r=!0;const{data:n}=t.getImageData(e,s,2*i||1,2*i||1),o=n.length;for(let t=3;t<o;t+=4){if(n[t]>0){r=!1;break}}return r};function os(t,e){const s=t.style;s&&("string"==typeof e?t.style.cssText+=";"+e:Object.entries(e).forEach((([t,e])=>s.setProperty(t,e))))}class as extends Ut{uniformScaling;uniScaleKey;centeredScaling;centeredRotation;centeredKey;altActionKey;interactive=!0;selection;selectionKey;altSelectionKey;selectionColor;selectionDashArray;selectionBorderColor;selectionLineWidth;selectionFullyContained;hoverCursor;moveCursor;defaultCursor;freeDrawingCursor;notAllowedCursor;containerClass;perPixelTargetFind;targetFindTolerance;skipTargetFind;isDrawingMode;preserveObjectStacking;stopContextMenu;fireRightClick;fireMiddleClick;targets=[];_hoveredTarget;_hoveredTargets=[];_objectsToRender=[];_currentTransform=null;_groupSelector=null;contextTopDirty=!1;contextCache;_absolutePointer;_pointer;_target;upperCanvasEl;contextTop;wrapperEl;cacheCanvasEl;_isCurrentlyDrawing;freeDrawingBrush;_activeObject;_hasITextHandlers;_iTextInstances;constructor(t,e={}){super(t,e)}_init(t,e={}){this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(t,e),this._applyCanvasStyle(this.lowerCanvasEl),this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this._initRetinaScaling(),this.calcOffset(),this._createCacheCanvas()}_initRetinaScaling(){super._initRetinaScaling(),this.__initRetinaScaling(this.upperCanvasEl,this.contextTop)}_onObjectAdded(t){this._objectsToRender=void 0,super._onObjectAdded(t)}_onObjectRemoved(t){this._objectsToRender=void 0,t===this._activeObject&&(this.fire("before:selection:cleared",{deselected:[t]}),this._discardActiveObject(),this.fire("selection:cleared",{deselected:[t]}),t.fire("deselected",{target:t})),t===this._hoveredTarget&&(this._hoveredTarget=void 0,this._hoveredTargets=[]),super._onObjectRemoved(t)}_chooseObjectsToRender(){const t=this.getActiveObjects();let e,s;if(!this.preserveObjectStacking&&t.length>1){e=[],s=[];for(let i=0,r=this._objects.length;i<r;i++){const r=this._objects[i];-1===t.indexOf(r)?e.push(r):s.push(r)}t.length>1&&zt(this._activeObject)&&(this._activeObject._objects=s),e.push(...s)}else if(this.preserveObjectStacking||1!==t.length)e=this._objects;else{const s=t[0],i=s.getAncestors(!0),r=0===i.length?s:i.pop();e=this._objects.slice();e.indexOf(r)>-1&&e.splice(e.indexOf(r),1),e.push(r)}return e}renderAll(){this.cancelRequestedRender(),this.destroyed||(!this.contextTopDirty||this._groupSelector||this.isDrawingMode||(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&(this.renderTopLayer(this.contextTop),this.hasLostContext=!1),!this._objectsToRender&&(this._objectsToRender=this._chooseObjectsToRender()),this.renderCanvas(this.contextContainer,this._objectsToRender))}renderTopLayer(t){t.save(),this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(t),this.contextTopDirty=!0),t.restore()}renderTop(){const t=this.contextTop;this.clearContext(t),this.renderTopLayer(t),this.fire("after:render",{ctx:t})}_normalizePointer(t,e){return J(this.restorePointerVpt(e),Z(t.calcTransformMatrix()))}isTargetTransparent(t,e,s){if((i=t).shouldCache()&&i._cacheCanvas&&t!==this._activeObject){const i=this._normalizePointer(t,new y(e,s)),r=Math.max(t.cacheTranslationX+i.x*t.zoomX,0),n=Math.max(t.cacheTranslationY+i.y*t.zoomY,0);return ns(t._cacheContext,Math.round(r),Math.round(n),this.targetFindTolerance)}var i;const r=this.contextCache,n=t.selectionBackgroundColor,o=this.viewportTransform;return t.selectionBackgroundColor="",this.clearContext(r),r.save(),r.transform(o[0],o[1],o[2],o[3],o[4],o[5]),t.render(r),r.restore(),t.selectionBackgroundColor=n,ns(r,e,s,this.targetFindTolerance)}_isSelectionKeyPressed(t){const e=this.selectionKey;return!!e&&(Array.isArray(e)?!!e.find((e=>!!e&&!0===t[e])):t[e])}_shouldClearSelection(t,e){const s=this.getActiveObjects(),i=this._activeObject;return!!(!e||e&&i&&s.length>1&&-1===s.indexOf(e)&&i!==e&&!this._isSelectionKeyPressed(t)||e&&!e.evented||e&&!e.selectable&&i&&i!==e)}_shouldCenterTransform(t,e,s){if(!t)return;let i;return"scale"===e||"scaleX"===e||"scaleY"===e||"resizing"===e?i=this.centeredScaling||t.centeredScaling:"rotate"===e&&(i=this.centeredRotation||t.centeredRotation),i?!s:s}_getOriginFromCorner(t,e){const s={x:t.originX,y:t.originY};return["ml","tl","bl"].includes(e)?s.x="right":["mr","tr","br"].includes(e)&&(s.x="left"),["tl","mt","tr"].includes(e)?s.y="bottom":["bl","mb","br"].includes(e)&&(s.y="top"),s}_setupCurrentTransform(t,e,s){if(!e)return;let i=this.getPointer(t);e.group&&(i=De(i,e.group.calcTransformMatrix()));const r=e.__corner||"",n=e.controls[r],o=s&&r?n.getActionHandler(t,e,n):$e,a=((t,e,s,i)=>{if(!e||!t)return"drag";const r=i.controls[e];return r.getActionName(s,r,i)})(s,r,t,e),h=this._getOriginFromCorner(e,r),c=t[this.centeredKey],l={target:e,action:a,actionHandler:o,actionPerformed:!1,corner:r,scaleX:e.scaleX,scaleY:e.scaleY,skewX:e.skewX,skewY:e.skewY,offsetX:i.x-e.left,offsetY:i.y-e.top,originX:h.x,originY:h.y,ex:i.x,ey:i.y,lastX:i.x,lastY:i.y,theta:q(e.angle),width:e.width,height:e.height,shiftKey:t.shiftKey,altKey:c,original:{...Qt(e),originX:h.x,originY:h.y}};this._shouldCenterTransform(e,a,c)&&(l.originX="center",l.originY="center"),this._currentTransform=l,this._beforeTransform(t)}setCursor(t){this.upperCanvasEl.style.cursor=t}_drawSelection(t){const{ex:e,ey:s,left:i,top:r}=this._groupSelector,n=new y(e,s).transform(this.viewportTransform),o=new y(e+i,s+r).transform(this.viewportTransform),a=this.selectionLineWidth/2;let h=Math.min(n.x,o.x),c=Math.min(n.y,o.y),l=Math.max(n.x,o.x),u=Math.max(n.y,o.y);this.selectionColor&&(t.fillStyle=this.selectionColor,t.fillRect(h,c,l-h,u-c)),this.selectionLineWidth&&this.selectionBorderColor&&(t.lineWidth=this.selectionLineWidth,t.strokeStyle=this.selectionBorderColor,h+=a,c+=a,l-=a,u-=a,ge.prototype._setLineDash.call(this,t,this.selectionDashArray),t.strokeRect(h,c,l-h,u-c))}findTarget(t,e=!1){if(this.skipTargetFind)return;const s=this.getPointer(t,!0),i=this._activeObject,r=this.getActiveObjects(),n=(a=t,je.indexOf(a.type)>-1||"touch"===a.pointerType),o=r.length>1&&!e||1===r.length;var a;if(this.targets=[],i&&o&&i._findTargetCorner(s,n))return i;if(r.length>1&&Wt(i)&&!e&&this.searchPossibleTargets([i],s))return i;let h,c=[];if(i&&1===r.length&&i===this.searchPossibleTargets([i],s)){if(!this.preserveObjectStacking)return i;h=i,c=this.targets,this.targets=[]}const l=this.searchPossibleTargets(this._objects,s);return t[this.altSelectionKey]&&l&&h&&l!==h?(this.targets=c,h):l}_checkTarget(t,e,s){if(e&&e.visible&&e.evented&&e.containsPoint(t)){if(!this.perPixelTargetFind&&!e.perPixelTargetFind||e.isEditing)return!0;if(!this.isTargetTransparent(e,s.x,s.y))return!0}return!1}_searchPossibleTargets(t,e){let s,i=t.length;for(;i--;){const r=t[i],n=r.group?this._normalizePointer(r.group,e):e;if(this._checkTarget(n,r,e)){if(s=t[i],zt(s)&&s.subTargetCheck){const t=this._searchPossibleTargets(s._objects,e);t&&this.targets.push(t)}break}}return s}searchPossibleTargets(t,e){const s=this._searchPossibleTargets(t,e);return s&&zt(s)&&s.interactive&&this.targets[0]?this.targets[0]:s}restorePointerVpt(t){return t.transform(Z(this.viewportTransform))}getPointer(t,e=!1){if(this._absolutePointer&&!e)return this._absolutePointer;if(this._pointer&&e)return this._pointer;const s=this.upperCanvasEl,i=s.getBoundingClientRect();let r=(t=>{const e=I(t.target),s=function(t){const e=t.changedTouches;return e&&e[0]?e[0]:t}(t);return new y(s.clientX+e.left,s.clientY+e.top)})(t),n=i.width||0,o=i.height||0;n&&o||("top"in i&&"bottom"in i&&(o=Math.abs(i.top-i.bottom)),"right"in i&&"left"in i&&(n=Math.abs(i.right-i.left))),this.calcOffset(),r.x=r.x-this._offset.left,r.y=r.y-this._offset.top,e||(r=this.restorePointerVpt(r));const a=this.getRetinaScaling();1!==a&&(r.x/=a,r.y/=a);const h=0===n||0===o?new y(1,1):new y(s.width/n,s.height/o);return r.multiply(h)}setDimensions(t,e){this._resetTransformEventData(),super.setDimensions(t,e),this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(this.contextTop)}_setBackstoreDimension(t,e){super._setBackstoreDimension(t,e),this.upperCanvasEl[t]=e,this.cacheCanvasEl[t]=e}_setCssDimension(t,e){super._setCssDimension(t,e),this.upperCanvasEl.style[t]=e,this.wrapperEl.style[t]=e}_createUpperCanvas(){const t=this.lowerCanvasEl;this.upperCanvasEl||(this.upperCanvasEl=this._createCanvasElement());const e=this.upperCanvasEl;e.className=t.className,e.classList.remove("lower-canvas"),e.classList.add("upper-canvas"),e.setAttribute("data-fabric","top"),this.wrapperEl.appendChild(e),e.style.cssText=t.style.cssText,this._applyCanvasStyle(e),e.setAttribute("draggable","true"),this.contextTop=e.getContext("2d")}_createCacheCanvas(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",`${this.width}`),this.cacheCanvasEl.setAttribute("height",`${this.height}`),this.contextCache=this.cacheCanvasEl.getContext("2d")}_initWrapperElement(){if(this.wrapperEl)return;const t=l.document.createElement("div");var e,s;t.classList.add(this.containerClass),this.wrapperEl=(e=this.lowerCanvasEl,s=t,e.parentNode&&e.parentNode.replaceChild(s,e),s.appendChild(e),s),this.wrapperEl.setAttribute("data-fabric","wrapper"),os(this.wrapperEl,{width:`${this.width}px`,height:`${this.height}px`,position:"relative"}),$(this.wrapperEl)}_applyCanvasStyle(t){const e=this.width||t.width,s=this.height||t.height;os(t,{position:"absolute",width:e+"px",height:s+"px",left:0,top:0,"touch-action":this.allowTouchScrolling?"manipulation":"none","-ms-touch-action":this.allowTouchScrolling?"manipulation":"none"}),t.width=e,t.height=s,$(t)}getTopContext(){return this.contextTop}getSelectionContext(){return this.contextTop}getSelectionElement(){return this.upperCanvasEl}getActiveObject(){return this._activeObject}getActiveObjects(){const t=this._activeObject;return t?Wt(t)?[...t._objects]:[t]:[]}_fireSelectionEvents(t,e){let s=!1,i=!1;const r=this.getActiveObjects(),n=[],o=[];t.forEach((t=>{r.includes(t)||(s=!0,t.fire("deselected",{e:e,target:t}),o.push(t))})),r.forEach((i=>{t.includes(i)||(s=!0,i.fire("selected",{e:e,target:i}),n.push(i))})),t.length>0&&r.length>0?(i=!0,s&&this.fire("selection:updated",{e:e,selected:n,deselected:o})):r.length>0?(i=!0,this.fire("selection:created",{e:e,selected:n})):t.length>0&&(i=!0,this.fire("selection:cleared",{e:e,deselected:o})),i&&(this._objectsToRender=void 0)}setActiveObject(t,e){const s=this.getActiveObjects();this._setActiveObject(t,e),this._fireSelectionEvents(s,e)}_setActiveObject(t,e){return this._activeObject!==t&&(!!this._discardActiveObject(e,t)&&(!t.onSelect({e:e})&&(this._activeObject=t,!0)))}_discardActiveObject(t,e){const s=this._activeObject;if(s){if(s.onDeselect({e:t,object:e}))return!1;this._currentTransform&&this._currentTransform.target===s&&this.endCurrentTransform(t),this._activeObject=void 0}return!0}discardActiveObject(t){const e=this.getActiveObjects(),s=this.getActiveObject();e.length&&this.fire("before:selection:cleared",{e:t,deselected:[s]}),this._discardActiveObject(t),this._fireSelectionEvents(e,t)}destroy(){const t=this.wrapperEl,e=this.lowerCanvasEl,s=this.upperCanvasEl,i=this.cacheCanvasEl;this.removeListeners(),super.destroy(),t.removeChild(s),t.removeChild(e),this._iTextInstances=[],this.contextCache=null,this.contextTop=null,z(s),this.upperCanvasEl=void 0,z(i),this.cacheCanvasEl=void 0,t.parentNode&&t.parentNode.replaceChild(e,t),this.wrapperEl=void 0}clear(){this.discardActiveObject(),this.clearContext(this.contextTop),this._hasITextHandlers&&(this.off("mouse:up",this._mouseUpITextHandler),this._iTextInstances=[],this._hasITextHandlers=!1),super.clear()}drawControls(t){const e=this._activeObject;e&&e._renderControls(t)}_toObject(t,e,s){const i=this._realizeGroupTransformOnObject(t),r=super._toObject(t,e,s);return t.set(i),r}_realizeGroupTransformOnObject(t){if(t.group&&Wt(t.group)&&this._activeObject===t.group){const e=_t(t,["angle","flipX","flipY","left","scaleX","scaleY","skewX","skewY","top"]);return((t,e)=>{Zt(t,Q(e,t.calcOwnMatrix()))})(t,this._activeObject.calcOwnMatrix()),e}return{}}_setSVGObject(t,e,s){const i=this._realizeGroupTransformOnObject(e);super._setSVGObject(t,e,s),e.set(i)}setViewportTransform(t){this.renderOnAddRemove&&Nt(this._activeObject)&&this._activeObject.isEditing&&this._activeObject.clearContextTop(),super.setViewportTransform(t)}}Object.assign(as.prototype,{uniformScaling:!0,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",selection:!0,selectionKey:"shiftKey",altSelectionKey:null,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",notAllowedCursor:"not-allowed",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,preserveObjectStacking:!1,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,enablePointerEvents:!1});const hs={passive:!1};function cs(t,e){return!!t.button&&t.button===e-1}const ls=(t,...e)=>t.addEventListener(...e),us=(t,...e)=>t.removeEventListener(...e),ds={mouse:{in:"over",out:"out",targetIn:"mouseover",targetOut:"mouseout",canvasIn:"mouse:over",canvasOut:"mouse:out"},drag:{in:"enter",out:"leave",targetIn:"dragenter",targetOut:"dragleave",canvasIn:"drag:enter",canvasOut:"drag:leave"}};class gs extends as{mainTouchId;enablePointerEvents;eventsBound;_willAddMouseDown;_draggedoverTarget;_dragSource;currentTarget;currentSubTargets;_previousPointer;_initEventListeners(){this.removeListeners(),this._bindEvents(),this.addOrRemove(ls,"add")}_getEventPrefix(){return this.enablePointerEvents?"pointer":"mouse"}addOrRemove(t,e){const s=this.upperCanvasEl,i=this._getEventPrefix();t(l.window,"resize",this._onResize),t(s,i+"down",this._onMouseDown),t(s,`${i}move`,this._onMouseMove,hs),t(s,`${i}out`,this._onMouseOut),t(s,`${i}enter`,this._onMouseEnter),t(s,"wheel",this._onMouseWheel),t(s,"contextmenu",this._onContextMenu),t(s,"dblclick",this._onDoubleClick),t(s,"dragstart",this._onDragStart),t(s,"dragend",this._onDragEnd),t(s,"dragover",this._onDragOver),t(s,"dragenter",this._onDragEnter),t(s,"dragleave",this._onDragLeave),t(s,"drop",this._onDrop),this.enablePointerEvents||t(s,"touchstart",this._onTouchStart,hs)}removeListeners(){this.addOrRemove(us,"remove");const t=this._getEventPrefix();us(l.document,`${t}up`,this._onMouseUp),us(l.document,"touchend",this._onTouchEnd,hs),us(l.document,`${t}move`,this._onMouseMove,hs),us(l.document,"touchmove",this._onMouseMove,hs)}_bindEvents(){this.eventsBound||(["_onMouseDown","_onTouchStart","_onMouseMove","_onMouseUp","_onTouchEnd","_onResize","_onMouseWheel","_onMouseOut","_onMouseEnter","_onContextMenu","_onDoubleClick","_onDragStart","_onDragEnd","_onDragProgress","_onDragOver","_onDragEnter","_onDragLeave","_onDrop"].forEach((t=>{this[t]=this[t].bind(this)})),this.eventsBound=!0)}_onMouseWheel(t){this.__onMouseWheel(t)}_onMouseOut(t){const e=this._hoveredTarget,s={e:t,isClick:!1,pointer:this.getPointer(t),absolutePointer:this.getPointer(t,!0)};this.fire("mouse:out",{...s,target:e}),this._hoveredTarget=void 0,e&&e.fire("mouseout",{...s}),this._hoveredTargets.forEach((t=>{this.fire("mouse:out",{...s,target:t}),t&&t.fire("mouseout",{...s})})),this._hoveredTargets=[]}_onMouseEnter(t){this._currentTransform||this.findTarget(t)||(this.fire("mouse:over",{e:t,isClick:!1,pointer:this.getPointer(t),absolutePointer:this.getPointer(t,!0)}),this._hoveredTarget=void 0,this._hoveredTargets=[])}_onDragStart(t){const e=this.getActiveObject();if((s=e)&&"function"==typeof s.onDragStart&&e.onDragStart(t)){this._dragSource=e;const s={e:t,target:e};return this.fire("dragstart",s),e.fire("dragstart",s),void ls(this.upperCanvasEl,"drag",this._onDragProgress)}var s;Ee(t)}_renderDragEffects(t,e,s){const i=this.contextTop;e&&(e.clearContextTop(!0),e.renderDragSourceEffect(t)),s&&(s!==e&&(i.restore(),i.save(),s.clearContextTop(!0)),s.renderDropTargetEffect(t)),i.restore()}_onDragEnd(t){const e=!!t.dataTransfer&&"none"!==t.dataTransfer.dropEffect,s=e?this._activeObject:void 0,i={e:t,target:this._dragSource,subTargets:this.targets,dragSource:this._dragSource,didDrop:e,dropTarget:s};us(this.upperCanvasEl,"drag",this._onDragProgress),this.fire("dragend",i),this._dragSource&&this._dragSource.fire("dragend",i),delete this._dragSource,this._onMouseUp(t)}_onDragProgress(t){const e={e:t,target:this._dragSource,dragSource:this._dragSource,dropTarget:this._draggedoverTarget};this.fire("drag",e),this._dragSource&&this._dragSource.fire("drag",e)}_onDragOver(t){const e="dragover",s=this.findTarget(t),i=this.targets,r={e:t,target:s,subTargets:i,dragSource:this._dragSource,canDrop:!1,dropTarget:void 0};let n;this.fire(e,r),this._fireEnterLeaveEvents(s,r),s&&(s.canDrop(t)&&(n=s),s.fire(e,r));for(let s=0;s<i.length;s++){const o=i[s];!t.defaultPrevented&&o.canDrop(t)&&(n=o),o.fire(e,r)}this._renderDragEffects(t,this._dragSource,n)}_onDragEnter(t){const e=this.findTarget(t),s={e:t,target:e,subTargets:this.targets,dragSource:this._dragSource};this.fire("dragenter",s),this._fireEnterLeaveEvents(e,s)}_onDragLeave(t){const e={e:t,target:this._draggedoverTarget,subTargets:this.targets,dragSource:this._dragSource};this.fire("dragleave",e),this._fireEnterLeaveEvents(void 0,e),this.targets=[],this._hoveredTargets=[]}_onDrop(t){const e=this._simpleEventHandler("drop:before",{e:t,dragSource:this._dragSource,pointer:this.getPointer(t)});e.didDrop=!1,e.dropTarget=void 0,this._basicEventHandler("drop",e),this.fire("drop:after",e)}_onContextMenu(t){const e=this._simpleEventHandler("contextmenu:before",{e:t});return this.stopContextMenu&&Ee(t),this._basicEventHandler("contextmenu",e),!1}_onDoubleClick(t){this._cacheTransformEventData(t),this._handleEvent(t,"dblclick"),this._resetTransformEventData()}getPointerId(t){const e=t.changedTouches;return e?e[0]&&e[0].identifier:this.enablePointerEvents?t.pointerId:-1}_isMainEvent(t){return!0===t.isPrimary||!1!==t.isPrimary&&("touchend"===t.type&&0===t.touches.length||(!t.changedTouches||t.changedTouches[0].identifier===this.mainTouchId))}_onTouchStart(t){t.preventDefault(),null===this.mainTouchId&&(this.mainTouchId=this.getPointerId(t)),this.__onMouseDown(t),this._resetTransformEventData();const e=this.upperCanvasEl,s=this._getEventPrefix();ls(l.document,"touchend",this._onTouchEnd,hs),ls(l.document,"touchmove",this._onMouseMove,hs),us(e,s+"down",this._onMouseDown)}_onMouseDown(t){this.__onMouseDown(t),this._resetTransformEventData();const e=this.upperCanvasEl,s=this._getEventPrefix();us(e,`${s}move`,this._onMouseMove,hs),ls(l.document,`${s}up`,this._onMouseUp),ls(l.document,`${s}move`,this._onMouseMove,hs)}_onTouchEnd(t){if(t.touches.length>0)return;this.__onMouseUp(t),this._resetTransformEventData(),this.mainTouchId=null;const e=this._getEventPrefix();us(l.document,"touchend",this._onTouchEnd,hs),us(l.document,"touchmove",this._onMouseMove,hs),this._willAddMouseDown&&clearTimeout(this._willAddMouseDown),this._willAddMouseDown=setTimeout((()=>{ls(this.upperCanvasEl,e+"down",this._onMouseDown),this._willAddMouseDown=0}),400)}_onMouseUp(t){this.__onMouseUp(t),this._resetTransformEventData();const e=this.upperCanvasEl,s=this._getEventPrefix();this._isMainEvent(t)&&(us(l.document,`${s}up`,this._onMouseUp),us(l.document,`${s}move`,this._onMouseMove,hs),ls(e,`${s}move`,this._onMouseMove,hs))}_onMouseMove(t){const e=this.getActiveObject();!this.allowTouchScrolling&&(!e||!e.__isDragging)&&t.preventDefault&&t.preventDefault(),this.__onMouseMove(t)}_onResize(){this.calcOffset(),this._resetTransformEventData()}_shouldRender(t){const e=this.getActiveObject();return!!(!!e!=!!t||e&&t&&e!==t)||(Nt(e),!1)}__onMouseUp(t){const e=this._currentTransform,s=this._groupSelector,i=!s||0===s.left&&0===s.top;this._cacheTransformEventData(t);const r=this._target;if(this._handleEvent(t,"up:before"),cs(t,3))return void(this.fireRightClick&&this._handleEvent(t,"up",3,i));if(cs(t,2))return this.fireMiddleClick&&this._handleEvent(t,"up",2,i),void this._resetTransformEventData();if(this.isDrawingMode&&this._isCurrentlyDrawing)return void this._onMouseUpInDrawingMode(t);if(!this._isMainEvent(t))return;let n,o,a=!1;if(e&&(this._finalizeCurrentTransform(t),a=e.actionPerformed),!i){const e=r===this._activeObject;this._maybeGroupObjects(t),a||(a=this._shouldRender(r)||!e&&r===this._activeObject)}if(r){if(o=r._findTargetCorner(this.getPointer(t,!0),l.util.isTouchEvent(t)),r.selectable&&r!==this._activeObject&&"up"===r.activeOn)this.setActiveObject(r,t),a=!0;else{const s=r.controls[o],i=s&&s.getMouseUpHandler(t,r,s);i&&(n=this.getPointer(t),i(t,e,n.x,n.y))}r.isMoving=!1}if(e&&(e.target!==r||e.corner!==o)){const s=e.target&&e.target.controls[e.corner],i=s&&s.getMouseUpHandler(t,e.target,s);n=n||this.getPointer(t),i&&i(t,e,n.x,n.y)}this._setCursorFromEvent(t,r),this._handleEvent(t,"up",1,i),this._groupSelector=null,this._currentTransform=null,r&&(r.__corner=0),a?this.requestRenderAll():i||this.renderTop()}_simpleEventHandler(t,{e:e,...s}){const i=this.findTarget(e),r=this.targets||[];return this._basicEventHandler(t,{e:e,target:i,subTargets:r,...s})}_basicEventHandler(t,e){const{target:s,subTargets:i=[]}=e;this.fire(t,e),s&&s.fire(t,e);for(let s=0;s<i.length;s++)i[s].fire(t,e);return e}_handleEvent(t,e,s=1,i=!1){const r=this._target,n=this.targets||[],o={e:t,target:r,subTargets:n,button:s,isClick:i,pointer:this.getPointer(t),absolutePointer:this.getPointer(t,!0),transform:this._currentTransform};"up"===e&&(o.currentTarget=this.findTarget(t),o.currentSubTargets=this.targets),this.fire(`mouse:${e}`,o),r&&r.fire(`mouse${e}`,o);for(let t=0;t<n.length;t++)n[t].fire(`mouse${e}`,o)}endCurrentTransform(t){const e=this._currentTransform;this._finalizeCurrentTransform(t),e&&e.target&&(e.target.isMoving=!1),this._currentTransform=null}_finalizeCurrentTransform(t){const e=this._currentTransform,s=e.target,i={e:t,target:s,transform:e,action:e.action};s._scaling&&(s._scaling=!1),s.setCoords(),(e.actionPerformed||this.stateful&&s.hasStateChanged())&&(this.fire("object:modified",i),s.fire("modified",i))}_onMouseDownInDrawingMode(t){this._isCurrentlyDrawing=!0,this.getActiveObject()&&(this.discardActiveObject(t),this.requestRenderAll());const e=this.getPointer(t);this.freeDrawingBrush&&this.freeDrawingBrush.onMouseDown(e,{e:t,pointer:e}),this._handleEvent(t,"down")}_onMouseMoveInDrawingMode(t){if(this._isCurrentlyDrawing){const e=this.getPointer(t);this.freeDrawingBrush&&this.freeDrawingBrush.onMouseMove(e,{e:t,pointer:e})}this.setCursor(this.freeDrawingCursor),this._handleEvent(t,"move")}_onMouseUpInDrawingMode(t){const e=this.getPointer(t);this.freeDrawingBrush?this._isCurrentlyDrawing=!!this.freeDrawingBrush.onMouseUp({e:t,pointer:e}):this._isCurrentlyDrawing=!1,this._handleEvent(t,"up")}__onMouseDown(t){this._cacheTransformEventData(t),this._handleEvent(t,"down:before");let e=this._target;if(cs(t,3))return void(this.fireRightClick&&this._handleEvent(t,"down",3));if(cs(t,2))return void(this.fireMiddleClick&&this._handleEvent(t,"down",2));if(this.isDrawingMode)return void this._onMouseDownInDrawingMode(t);if(!this._isMainEvent(t))return;if(this._currentTransform)return;const s=this.getPointer(t,!0);this._previousPointer=s;const i=this._shouldRender(e),r=this._shouldGroup(t,e);if(this._shouldClearSelection(t,e)?this.discardActiveObject(t):r&&(this._handleGrouping(t,e),e=this._activeObject),this.selection&&(!e||!e.selectable&&!e.isEditing&&e!==this._activeObject)){const e=this.getPointer(t);this._groupSelector={ex:e.x,ey:e.y,top:0,left:0}}if(e){const s=e===this._activeObject;e.selectable&&"down"===e.activeOn&&this.setActiveObject(e,t);const i=e._findTargetCorner(this.getPointer(t,!0),l.util.isTouchEvent(t));if(e===this._activeObject&&(i||!r)){this._setupCurrentTransform(t,e,s);const r=e.controls[i],n=this.getPointer(t),o=r&&r.getMouseDownHandler(t,e,r);o&&o(t,this._currentTransform,n.x,n.y)}}const n=i||r;n&&(this._objectsToRender=void 0),this._handleEvent(t,"down"),n&&this.requestRenderAll()}_resetTransformEventData(){this._target=void 0,this._pointer=void 0,this._absolutePointer=void 0}_cacheTransformEventData(t){this._resetTransformEventData(),this._pointer=this.getPointer(t,!0),this._absolutePointer=this.restorePointerVpt(this._pointer),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(t)}_beforeTransform(t){const e=this._currentTransform;this.stateful&&e.target.saveState(),this.fire("before:transform",{e:t,transform:e})}__onMouseMove(t){if(this._handleEvent(t,"move:before"),this._cacheTransformEventData(t),this.isDrawingMode)return void this._onMouseMoveInDrawingMode(t);if(!this._isMainEvent(t))return;const e=this._groupSelector;if(e){const s=this.getPointer(t);e.left=s.x-e.ex,e.top=s.y-e.ey,this.renderTop()}else if(this._currentTransform)this._transformObject(t);else{const e=this.findTarget(t);this._setCursorFromEvent(t,e),this._fireOverOutEvents(t,e)}this._handleEvent(t,"move"),this._resetTransformEventData()}_fireOverOutEvents(t,e){const s=this._hoveredTarget,i=this._hoveredTargets,r=this.targets,n=Math.max(i.length,r.length);this.fireSyntheticInOutEvents("mouse",{e:t,target:e,oldTarget:s,fireCanvas:!0});for(let e=0;e<n;e++)this.fireSyntheticInOutEvents("mouse",{e:t,target:r[e],oldTarget:i[e]});this._hoveredTarget=e,this._hoveredTargets=this.targets.concat()}_fireEnterLeaveEvents(t,e){const s=this._draggedoverTarget,i=this._hoveredTargets,r=this.targets,n=Math.max(i.length,r.length);this.fireSyntheticInOutEvents("drag",{...e,target:t,oldTarget:s,fireCanvas:!0});for(let t=0;t<n;t++)this.fireSyntheticInOutEvents("drag",{...e,target:r[t],oldTarget:i[t]});this._draggedoverTarget=t}fireSyntheticInOutEvents(t,{target:e,oldTarget:s,fireCanvas:i,e:r,...n}){const{targetIn:o,targetOut:a,canvasIn:h,canvasOut:c}=ds[t],l=s!==e;if(s&&l){const t={...n,e:r,target:s,nextTarget:e,isClick:!1,pointer:this.getPointer(r),absolutePointer:this.getPointer(r,!0)};i&&this.fire(h,t),s.fire(a,t)}if(e&&l){const t={...n,e:r,target:e,previousTarget:s,isClick:!1,pointer:this.getPointer(r),absolutePointer:this.getPointer(r,!0)};i&&this.fire(c,t),e.fire(o,t)}}__onMouseWheel(t){this._cacheTransformEventData(t),this._handleEvent(t,"wheel"),this._resetTransformEventData()}_transformObject(t){const e=this.getPointer(t),s=this._currentTransform,i=s.target,r=i.group?De(e,void 0,i.group.calcTransformMatrix()):e;s.reset=!1,s.shiftKey=t.shiftKey,s.altKey=!!this.centeredKey&&t[this.centeredKey],this._performTransformAction(t,s,r),s.actionPerformed&&this.requestRenderAll()}_performTransformAction(t,e,s){const i=s.x,r=s.y,n=e.action,o=e.actionHandler;let a=!1;o&&(a=o(t,e,i,r)),"drag"===n&&a&&(e.target.isMoving=!0,this.setCursor(e.target.moveCursor||this.moveCursor)),e.actionPerformed=e.actionPerformed||a}_setCursorFromEvent(t,e){if(!e)return void this.setCursor(this.defaultCursor);let s=e.hoverCursor||this.hoverCursor;const i=Wt(this._activeObject)?this._activeObject:null,r=(!i||!i.contains(e))&&e._findTargetCorner(this.getPointer(t,!0));if(r){const s=e.controls[r];this.setCursor(s.cursorStyleHandler(t,s,e))}else e.subTargetCheck&&this.targets.concat().reverse().map((t=>{s=t.hoverCursor||s})),this.setCursor(s)}_shouldGroup(t,e){const s=this._activeObject;return!!s&&this._isSelectionKeyPressed(t)&&this.selection&&!!e&&e.selectable&&(s!==e||"activeSelection"===s.type)&&!e.isDescendantOf(s)&&!s.isDescendantOf(e)&&!e.onSelect({e:t})}_handleGrouping(t,e){let s=e;const i=this._activeObject;i.__corner||(s!==i||(s=this.findTarget(t,!0),s&&s.selectable))&&(i&&"activeSelection"===i.type?this._updateActiveSelection(t,s):this._createActiveSelection(t,s))}_updateActiveSelection(t,e){const s=this._activeObject,i=s.getObjects();e.group===s?(s.remove(e),this._hoveredTarget=e,this._hoveredTargets=this.targets.concat(),1===s.size()&&this._setActiveObject(s.item(0),t)):(s.add(e),this._hoveredTarget=s,this._hoveredTargets=this.targets.concat()),this._fireSelectionEvents(i,t)}_createActiveSelection(t,e){const s=this.getActiveObject(),i=e.isInFrontOf(s)?[s,e]:[e,s];s.isEditing&&s.exitEditing();const r=new ke(i,{canvas:this});this._hoveredTarget=r,this._setActiveObject(r,t),this._fireSelectionEvents([s],t)}_groupSelectedObjects(t){const e=this._collectObjects(t);if(1===e.length)this.setActiveObject(e[0],t);else if(e.length>1){const s=new ke(e.reverse(),{canvas:this});this.setActiveObject(s,t)}}_collectObjects(t){const e=[],s=this._groupSelector,i=new y(s.ex,s.ey),r=i.add(new y(s.left,s.top)),n=i.min(r),o=i.max(r),a=!this.selectionFullyContained,h=i.eq(r);for(let t=this._objects.length;t--;){const s=this._objects[t];if(s&&s.selectable&&s.visible&&((a&&s.intersectsWithRect(n,o,!0)||s.isContainedWithinRect(n,o,!0)||a&&s.containsPoint(n,void 0,!0)||a&&s.containsPoint(o,void 0,!0))&&(e.push(s),h)))break}return e.length>1?e.filter((e=>!e.onSelect({e:t}))):e}_maybeGroupObjects(t){this.selection&&this._groupSelector&&this._groupSelectedObjects(t),this.setCursor(this.defaultCursor),this._groupSelector=null}cloneWithoutData(){const t=H();return t.width=this.width,t.height=this.height,new gs(t)}}Object.assign(gs.prototype,{eventsBound:!1}),l.Canvas=gs,exports.Canvas=gs,exports.StaticCanvas=Ut,exports.config=e;
